import{Ca as p,b as h,d as g,f,g as l,j as m,ja as d,q as I,t as a,w as u}from"./chunk-62R4RV7J.js";var b=(()=>{let e=class e{constructor(){}setItem(t,r){localStorage.setItem(t,r)}getItem(t){return localStorage.getItem(t)}removeItem(t){localStorage.removeItem(t)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var D=(()=>{let e=class e{constructor(t,r,s){this.afAuth=t,this.router=r,this.storage=s,this.userDataSubject=new h(null),this.isLoggedInSubject=new h(!1),this.token=null;let o=this.storage.getItem("token");o?(this.isLoggedInSubject.next(!0),this.token=o,this.initUserData()):this.isLoggedInSubject.next(!1),this.afAuth.authState.subscribe(n=>{n?(this.isLoggedInSubject.next(!0),n.getIdToken().then(c=>{this.token=c,this.storage.setItem("token",this.token),this.initUserData()}).catch(c=>{console.error("Error al obtener el token:",c)})):this.isLoggedInSubject.next(!1)})}get isLoggedIn(){return this.isLoggedInSubject.asObservable()}signIn(t,r){return g(this.afAuth.signInWithEmailAndPassword(t,r)).pipe(l(s=>{let o=s.user;if(o){let n={email:o.email,displayName:o.displayName,uid:o.uid};return this.userDataSubject.next(n),this.router.navigate(["/mantainer"]),!0}return!1}),m(s=>(console.error("Error in signIn:",s),f(s))))}signOut(){return g(this.afAuth.signOut()).pipe(I(()=>{this.userDataSubject.next(null),this.isLoggedInSubject.next(!1),this.storage.removeItem("token"),this.router.navigate(["/auth"])}),l(()=>!0),m(t=>{throw console.error("Error in signOut:",t),t}))}getUserData(){return this.userDataSubject}getAuthToken(){return this.token}handleLoginError(t){console.error("Login error",t)}initUserData(){}};e.\u0275fac=function(r){return new(r||e)(u(p),u(d),u(b))},e.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();export{D as a};
