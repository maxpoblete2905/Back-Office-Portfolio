import{a as Ih,b as me,c as Eh,d as Th,e as Ah,f as Sh,g as xh,h as bh,i as Rh,j as Ph,k as Ch}from"./chunk-NVS7U25A.js";import{$ as Wi,A as He,E as Wl,F as z,G as Je,J as Yt,K as Hl,L as Gt,N as x,O as E,P as Ft,Q as Vn,R as Mt,S as Xt,T as b,U as xe,V as Pt,W as Jl,_ as Qi,a as Kl,aa as Yl,b as $l,ba as Xl,c as fe,d as Cn,e as Dt,ea as Zl,g as Jo,ga as Hi,h as Rr,ha as Xo,j as Ql,ja as oh,k as Gi,ka as ah,l as zi,la as Lt,m as Ki,ma as uh,n as Yo,na as ch,oa as lh,q as $i,qa as hh,r as Pr,ra as dh,s as Cr,sa as fh,t as at,ta as mh,ua as gh,v as Dn,va as ph,w as Dr,wa as yh,xa as _h,ya as wh,z as We,za as vh}from"./chunk-3A3WXGXF.js";import{a as Pn,b as br,c as Ho,d as p,k as th,l as Vr,m as Zo,n as eh,o as nh,q as ta,r as Z,s as Ji,t as Zt,u as rh,v as ih,w as sh,y as ea,z as na}from"./chunk-7FQVP44B.js";var Dh=(()=>{let t=class t{constructor(r){this.authService=r}logout(){this.authService.signOut().subscribe({next:()=>console.log("Closed session successful"),error:r=>console.error("Closed session error",r)})}};t.\u0275fac=function(i){return new(i||t)(Je(vh))},t.\u0275cmp=Dn({type:t,selectors:[["auth-layout"]],decls:17,vars:0,consts:[[1,"bg-gray-800","p-4"],[1,"container","mx-auto","flex","items-center","justify-between"],[1,"flex","items-center"],[1,"mr-6"],[1,"text-white","hover:text-blue-300","cursor-pointer"],["routerLink","list",1,"text-white","hover:text-blue-300","cursor-pointer"],["href","/opcion3",1,"text-white","hover:text-blue-300"],[1,"text-white"],[1,"bg-red-500","text-white","py-2","px-4","rounded","hover:bg-red-700",3,"click"]],template:function(i,s){i&1&&(x(0,"nav",0)(1,"div",1)(2,"ul",2)(3,"li",3)(4,"p",4),b(5,"skill "),E()(),x(6,"li",3)(7,"p",5),b(8,"projects "),E()(),x(9,"li")(10,"a",6),b(11,"Opci\xF3n 3"),E()()(),x(12,"div",7),b(13," Hola, max "),E(),x(14,"button",8),Mt("click",function(){return s.logout()}),b(15," Cerrar sesi\xF3n "),E()()(),Ft(16,"router-outlet"))},dependencies:[Zl,Hi]});let n=t;return n})();var Lp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kt={},A,Aa=Aa||{},N=Lp||self;function ls(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function $r(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function Op(n){return Object.prototype.hasOwnProperty.call(n,ra)&&n[ra]||(n[ra]=++qp)}var ra="closure_uid_"+(1e9*Math.random()>>>0),qp=0;function Up(n,t,e){return n.call.apply(n.bind,arguments)}function Bp(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(t,i)}}return function(){return n.apply(t,arguments)}}function It(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?It=Up:It=Bp,It.apply(null,arguments)}function Yi(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function gt(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function be(){this.s=this.s,this.o=this.o}var jp=0;be.prototype.s=!1;be.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),jp!=0)&&Op(this)};be.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var zh=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function Sa(n){let t=n.length;if(0<t){let e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function Vh(n,t){for(let e=1;e<arguments.length;e++){let r=arguments[e];if(ls(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Et(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}Et.prototype.h=function(){this.defaultPrevented=!0};var Gp=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};N.addEventListener("test",e,t),N.removeEventListener("test",e,t)}catch{}return n}();function Or(n){return/^[\s\xa0]*$/.test(n)}function hs(){var n=N.navigator;return n&&(n=n.userAgent)?n:""}function te(n){return hs().indexOf(n)!=-1}function xa(n){return xa[" "](n),n}xa[" "]=function(){};function zp(n,t){var e=Vy;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var Kp=te("Opera"),Ln=te("Trident")||te("MSIE"),Kh=te("Edge"),ua=Kh||Ln,$h=te("Gecko")&&!(hs().toLowerCase().indexOf("webkit")!=-1&&!te("Edge"))&&!(te("Trident")||te("MSIE"))&&!te("Edge"),$p=hs().toLowerCase().indexOf("webkit")!=-1&&!te("Edge");function Qh(){var n=N.document;return n?n.documentMode:void 0}var ca;t:{if(Xi="",Zi=function(){var n=hs();if($h)return/rv:([^\);]+)(\)|;)/.exec(n);if(Kh)return/Edge\/([\d\.]+)/.exec(n);if(Ln)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if($p)return/WebKit\/(\S+)/.exec(n);if(Kp)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Zi&&(Xi=Zi?Zi[1]:""),Ln&&(ts=Qh(),ts!=null&&ts>parseFloat(Xi))){ca=String(ts);break t}ca=Xi}var Xi,Zi,ts,la;N.document&&Ln?(ia=Qh(),la=ia||parseInt(ca,10)||void 0):la=void 0;var ia,Qp=la;function qr(n,t){if(Et.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if($h){t:{try{xa(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Wp[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&qr.$.h.call(this)}}gt(qr,Et);var Wp={2:"touch",3:"pen",4:"mouse"};qr.prototype.h=function(){qr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Qr="closure_listenable_"+(1e6*Math.random()|0),Hp=0;function Jp(n,t,e,r,i){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=i,this.key=++Hp,this.fa=this.ia=!1}function ds(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function ba(n,t,e){for(let r in n)t.call(e,n[r],r,n)}function Yp(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function Wh(n){let t={};for(let e in n)t[e]=n[e];return t}var Nh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Hh(n,t){let e,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(e in r)n[e]=r[e];for(let s=0;s<Nh.length;s++)e=Nh[s],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function fs(n){this.src=n,this.g={},this.h=0}fs.prototype.add=function(n,t,e,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=da(n,t,r,i);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new Jp(t,this.src,s,!!r,i),t.ia=e,n.push(t)),t};function ha(n,t){var e=t.type;if(e in n.g){var r=n.g[e],i=zh(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ds(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function da(n,t,e,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==r)return i}return-1}var Ra="closure_lm_"+(1e6*Math.random()|0),sa={};function Jh(n,t,e,r,i){if(r&&r.once)return Xh(n,t,e,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Jh(n,t[s],e,r,i);return null}return e=Da(e),n&&n[Qr]?n.O(t,e,$r(r)?!!r.capture:!!r,i):Yh(n,t,e,!1,r,i)}function Yh(n,t,e,r,i,s){if(!t)throw Error("Invalid event type");var o=$r(i)?!!i.capture:!!i,a=Ca(n);if(a||(n[Ra]=a=new fs(n)),e=a.add(t,e,r,o,s),e.proxy)return e;if(r=Xp(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)Gp||(i=o),i===void 0&&(i=!1),n.addEventListener(t.toString(),r,i);else if(n.attachEvent)n.attachEvent(td(t.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return e}function Xp(){function n(e){return t.call(n.src,n.listener,e)}let t=Zp;return n}function Xh(n,t,e,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Xh(n,t[s],e,r,i);return null}return e=Da(e),n&&n[Qr]?n.P(t,e,$r(r)?!!r.capture:!!r,i):Yh(n,t,e,!0,r,i)}function Zh(n,t,e,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Zh(n,t[s],e,r,i);else r=$r(r)?!!r.capture:!!r,e=Da(e),n&&n[Qr]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=da(s,e,r,i),-1<e&&(ds(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=Ca(n))&&(t=n.g[t.toString()],n=-1,t&&(n=da(t,e,r,i)),(e=-1<n?t[n]:null)&&Pa(e))}function Pa(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[Qr])ha(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(td(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=Ca(t))?(ha(e,n),e.h==0&&(e.src=null,t[Ra]=null)):ds(n)}}}function td(n){return n in sa?sa[n]:sa[n]="on"+n}function Zp(n,t){if(n.fa)n=!0;else{t=new qr(t,this);var e=n.listener,r=n.la||n.src;n.ia&&Pa(n),n=e.call(r,t)}return n}function Ca(n){return n=n[Ra],n instanceof fs?n:null}var oa="__closure_events_fn_"+(1e9*Math.random()>>>0);function Da(n){return typeof n=="function"?n:(n[oa]||(n[oa]=function(t){return n.handleEvent(t)}),n[oa])}function mt(){be.call(this),this.i=new fs(this),this.S=this,this.J=null}gt(mt,be);mt.prototype[Qr]=!0;mt.prototype.removeEventListener=function(n,t,e,r){Zh(this,n,t,e,r)};function wt(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,typeof t=="string")t=new Et(t,n);else if(t instanceof Et)t.target=t.target||n;else{var i=t;t=new Et(r,n),Hh(t,i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];i=es(o,r,!0,t)&&i}if(o=t.g=n,i=es(o,r,!0,t)&&i,i=es(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)o=t.g=e[s],i=es(o,r,!1,t)&&i}mt.prototype.N=function(){if(mt.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)ds(e[r]);delete n.g[t],n.h--}}this.J=null};mt.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)};mt.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};function es(n,t,e,r){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&ha(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Va=N.JSON.stringify,fa=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function ty(){var n=Na;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var ma=class{constructor(){this.h=this.g=null}add(t,e){let r=ed.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},ed=new fa(()=>new ga,n=>n.reset()),ga=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function ey(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function ny(n){N.setTimeout(()=>{throw n},0)}var Ur,Br=!1,Na=new ma,nd=()=>{let n=N.Promise.resolve(void 0);Ur=()=>{n.then(ry)}},ry=()=>{for(var n;n=ty();){try{n.h.call(n.g)}catch(e){ny(e)}var t=ed;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Br=!1};function ms(n,t){mt.call(this),this.h=n||1,this.g=t||N,this.j=It(this.qb,this),this.l=Date.now()}gt(ms,mt);A=ms.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),wt(this,"tick"),this.ga&&(ka(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ka(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){ms.$.N.call(this),ka(this),delete this.g};function Fa(n,t,e){if(typeof n=="function")e&&(n=It(n,e));else if(n&&typeof n.handleEvent=="function")n=It(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:N.setTimeout(n,t||0)}function rd(n){n.g=Fa(()=>{n.g=null,n.i&&(n.i=!1,rd(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var pa=class extends be{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:rd(this)}N(){super.N(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function jr(n){be.call(this),this.h=n,this.g={}}gt(jr,be);var kh=[];function id(n,t,e,r){Array.isArray(e)||(e&&(kh[0]=e.toString()),e=kh);for(var i=0;i<e.length;i++){var s=Jh(t,e[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function sd(n){ba(n.g,function(t,e){this.g.hasOwnProperty(e)&&Pa(t)},n),n.g={}}jr.prototype.N=function(){jr.$.N.call(this),sd(this)};jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function gs(){this.g=!0}gs.prototype.Ea=function(){this.g=!1};function iy(n,t,e,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+e+`
`+o})}function sy(n,t,e,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+e+`
`+s+" "+o})}function Fn(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+ay(n,e)+(r?" "+r:"")})}function oy(n,t){n.info(function(){return"TIMEOUT: "+t})}gs.prototype.info=function(){};function ay(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Va(e)}catch{return t}}var tn={},Fh=null;function ps(){return Fh=Fh||new mt}tn.Ta="serverreachability";function od(n){Et.call(this,tn.Ta,n)}gt(od,Et);function Gr(n){let t=ps();wt(t,new od(t))}tn.STAT_EVENT="statevent";function ad(n,t){Et.call(this,tn.STAT_EVENT,n),this.stat=t}gt(ad,Et);function St(n){let t=ps();wt(t,new ad(t,n))}tn.Ua="timingevent";function ud(n,t){Et.call(this,tn.Ua,n),this.size=t}gt(ud,Et);function Wr(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){n()},t)}var ys={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},cd={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ma(){}Ma.prototype.h=null;function Mh(n){return n.h||(n.h=n.i())}function ld(){}var Hr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function La(){Et.call(this,"d")}gt(La,Et);function Oa(){Et.call(this,"c")}gt(Oa,Et);var ya;function _s(){}gt(_s,Ma);_s.prototype.g=function(){return new XMLHttpRequest};_s.prototype.i=function(){return{}};ya=new _s;function Jr(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new jr(this),this.P=uy,n=ua?125:void 0,this.V=new ms(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new hd}function hd(){this.i=null,this.g="",this.h=!1}var uy=45e3,dd={},_a={};A=Jr.prototype;A.setTimeout=function(n){this.P=n};function wa(n,t,e){n.L=1,n.A=vs(pe(t)),n.u=e,n.S=!0,fd(n,null)}function fd(n,t){n.G=Date.now(),Yr(n),n.B=pe(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Id(e.i,"t",r),n.o=0,e=n.l.J,n.h=new hd,n.g=jd(n.l,e?t:null,!n.u),0<n.O&&(n.M=new pa(It(n.Pa,n,n.g),n.O)),id(n.U,n.g,"readystatechange",n.nb),t=n.I?Wh(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Gr(),iy(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;let t=this.M;t&&ee(n)==3?t.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)t:{let l=ee(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||ua||this.g&&(this.h.h||this.g.ja()||Uh(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?Gr(3):Gr(2)),ws(this);var e=this.g.da();this.ca=e;e:if(md(this)){var r=Uh(this.g);n="";var i=r.length,s=ee(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ye(this),Lr(this);var o="";break e}this.h.i=new N.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,sy(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Or(a)){var c=a;break e}}c=null}if(e=c)Fn(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,va(this,e);else{this.i=!1,this.s=3,St(12),Ye(this),Lr(this);break t}}this.S?(gd(this,l,o),ua&&this.i&&l==3&&(id(this.U,this.V,"tick",this.mb),this.V.start())):(Fn(this.j,this.m,o,null),va(this,o)),l==4&&Ye(this),this.i&&!this.J&&(l==4?Od(this.l,this):(this.i=!1,Yr(this)))}else Py(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,St(12)):(this.s=0,St(13)),Ye(this),Lr(this)}}}catch{}finally{}};function md(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function gd(n,t,e){let r=!0,i;for(;!n.J&&n.o<e.length;)if(i=cy(n,e),i==_a){t==4&&(n.s=4,St(14),r=!1),Fn(n.j,n.m,null,"[Incomplete Response]");break}else if(i==dd){n.s=4,St(15),Fn(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}else Fn(n.j,n.m,i,null),va(n,i);md(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,St(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),za(t),t.M=!0,St(11))):(Fn(n.j,n.m,e,"[Invalid Chunked Response]"),Ye(n),Lr(n))}A.mb=function(){if(this.g){var n=ee(this.g),t=this.g.ja();this.o<t.length&&(ws(this),gd(this,n,t),this.i&&n!=4&&Yr(this))}};function cy(n,t){var e=n.o,r=t.indexOf(`
`,e);return r==-1?_a:(e=Number(t.substring(e,r)),isNaN(e)?dd:(r+=1,r+e>t.length?_a:(t=t.slice(r,r+e),n.o=r+e,t)))}A.cancel=function(){this.J=!0,Ye(this)};function Yr(n){n.Y=Date.now()+n.P,pd(n,n.P)}function pd(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Wr(It(n.lb,n),t)}function ws(n){n.C&&(N.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(oy(this.j,this.B),this.L!=2&&(Gr(),St(17)),Ye(this),this.s=2,Lr(this)):pd(this,this.Y-n)};function Lr(n){n.l.H==0||n.J||Od(n.l,n)}function Ye(n){ws(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,ka(n.V),sd(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function va(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||Ia(e.i,n))){if(!n.K&&Ia(e.i,n)&&e.H==3){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)os(e),Ts(e);else break t;Ga(e),St(18)}}else e.Fa=i[1],0<e.Fa-e.V&&37500>i[2]&&e.G&&e.A==0&&!e.v&&(e.v=Wr(It(e.ib,e),6e3));if(1>=Ad(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else Xe(e,11)}else if((n.K||e.g==n)&&os(e),!Or(t))for(i=e.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(e.V=c[0],c=c[1],e.H==2)if(c[0]=="c"){e.K=c[1],e.pa=c[2];let l=c[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=c[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,e.L=r,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;let m=n.g;if(m){let S=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.i;s.g||S.indexOf("spdy")==-1&&S.indexOf("quic")==-1&&S.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(qa(s,s.h),s.h=null))}if(r.F){let w=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,H(r.I,r.F,w))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),r=e;var o=n;if(r.wa=Bd(r,r.J?r.pa:null,r.Y),o.K){Sd(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ws(a),Yr(a)),r.g=o}else Md(r);0<e.j.length&&As(e)}else c[0]!="stop"&&c[0]!="close"||Xe(e,7);else e.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Xe(e,7):ja(e):c[0]!="noop"&&e.h&&e.h.Aa(c),e.A=0)}}Gr(4)}catch{}}function ly(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(ls(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}t=[],e=0;for(r in n)t[e++]=n[r];return t}function hy(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ls(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let r in n)t[e++]=r;return t}}}function yd(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(ls(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=hy(n),r=ly(n),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],e&&e[s],n)}var _d=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dy(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),i=null;if(0<=r){var s=n[e].substring(0,r);i=n[e].substring(r+1)}else s=n[e];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ze(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ze){this.h=n.h,is(this,n.j),this.s=n.s,this.g=n.g,ss(this,n.m),this.l=n.l;var t=n.i,e=new zr;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Lh(this,e),this.o=n.o}else n&&(t=String(n).match(_d))?(this.h=!1,is(this,t[1]||"",!0),this.s=Fr(t[2]||""),this.g=Fr(t[3]||"",!0),ss(this,t[4]),this.l=Fr(t[5]||"",!0),Lh(this,t[6]||"",!0),this.o=Fr(t[7]||"")):(this.h=!1,this.i=new zr(null,this.h))}Ze.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Mr(t,Oh,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Mr(t,Oh,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Mr(e,e.charAt(0)=="/"?gy:my,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Mr(e,yy)),n.join("")};function pe(n){return new Ze(n)}function is(n,t,e){n.j=e?Fr(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function ss(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Lh(n,t,e){t instanceof zr?(n.i=t,_y(n.i,n.h)):(e||(t=Mr(t,py)),n.i=new zr(t,n.h))}function H(n,t,e){n.i.set(t,e)}function vs(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Fr(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Mr(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,fy),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function fy(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Oh=/[#\/\?@]/g,my=/[#\?:]/g,gy=/[#\?]/g,py=/[#\?@]/g,yy=/#/g;function zr(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function Re(n){n.g||(n.g=new Map,n.h=0,n.i&&dy(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}A=zr.prototype;A.add=function(n,t){Re(this),this.i=null,n=On(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function wd(n,t){Re(n),t=On(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function vd(n,t){return Re(n),t=On(n,t),n.g.has(t)}A.forEach=function(n,t){Re(this),this.g.forEach(function(e,r){e.forEach(function(i){n.call(t,i,r,this)},this)},this)};A.ta=function(){Re(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){let i=n[r];for(let s=0;s<i.length;s++)e.push(t[r])}return e};A.Z=function(n){Re(this);let t=[];if(typeof n=="string")vd(this,n)&&(t=t.concat(this.g.get(On(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};A.set=function(n,t){return Re(this),this.i=null,n=On(this,n),vd(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};A.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function Id(n,t,e){wd(n,t),0<e.length&&(n.i=null,n.g.set(On(n,t),Sa(e)),n.h+=e.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function On(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function _y(n,t){t&&!n.j&&(Re(n),n.i=null,n.g.forEach(function(e,r){var i=r.toLowerCase();r!=i&&(wd(this,r),Id(this,i,e))},n)),n.j=t}var wy=class{constructor(n,t){this.g=n,this.map=t}};function Ed(n){this.l=n||vy,N.PerformanceNavigationTiming?(n=N.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(N.g&&N.g.Ka&&N.g.Ka()&&N.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var vy=10;function Td(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Ad(n){return n.h?1:n.g?n.g.size:0}function Ia(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function qa(n,t){n.g?n.g.add(t):n.h=t}function Sd(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}Ed.prototype.cancel=function(){if(this.i=xd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function xd(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return Sa(n.i)}var Iy=class{stringify(n){return N.JSON.stringify(n,void 0)}parse(n){return N.JSON.parse(n,void 0)}};function Ey(){this.g=new Iy}function Ty(n,t,e){let r=e||"";try{yd(n,function(i,s){let o=i;$r(i)&&(o=Va(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ay(n,t){let e=new gs;if(N.Image){let r=new Image;r.onload=Yi(ns,e,r,"TestLoadImage: loaded",!0,t),r.onerror=Yi(ns,e,r,"TestLoadImage: error",!1,t),r.onabort=Yi(ns,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=Yi(ns,e,r,"TestLoadImage: timeout",!1,t),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}function ns(n,t,e,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function Xr(n){this.l=n.ec||null,this.j=n.ob||!1}gt(Xr,Ma);Xr.prototype.g=function(){return new Is(this.l,this.j)};Xr.prototype.i=function(n){return function(){return n}}({});function Is(n,t){mt.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=Ua,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}gt(Is,mt);var Ua=0;A=Is.prototype;A.open=function(n,t){if(this.readyState!=Ua)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Kr(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||N).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zr(this)),this.readyState=Ua};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof N.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;bd(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function bd(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Zr(this):Kr(this),this.readyState==3&&bd(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,Zr(this))};A.Ya=function(n){this.g&&(this.response=n,Zr(this))};A.ka=function(){this.g&&Zr(this)};function Zr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Kr(n)}A.setRequestHeader=function(n,t){this.v.append(n,t)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function Kr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Is.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Sy=N.JSON.parse;function tt(n){mt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Rd,this.L=this.M=!1}gt(tt,mt);var Rd="",xy=/^https?$/i,by=["POST","PUT"];A=tt.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ya.g(),this.C=this.u?Mh(this.u):Mh(ya),this.g.onreadystatechange=It(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){qh(this,s);return}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)e.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())e.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),i=N.FormData&&n instanceof N.FormData,!(0<=zh(by,t))||r||i||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Dd(this),0<this.B&&((this.L=Ry(this.g))?(this.g.timeout=this.B,this.g.ontimeout=It(this.ua,this)):this.A=Fa(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){qh(this,s)}};function Ry(n){return Ln&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof Aa<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,wt(this,"timeout"),this.abort(8))};function qh(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,Pd(n),Es(n)}function Pd(n){n.F||(n.F=!0,wt(n,"complete"),wt(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,wt(this,"complete"),wt(this,"abort"),Es(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Es(this,!0)),tt.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?Cd(this):this.kb())};A.kb=function(){Cd(this)};function Cd(n){if(n.h&&typeof Aa<"u"&&(!n.C[1]||ee(n)!=4||n.da()!=2)){if(n.v&&ee(n)==4)Fa(n.La,0,n);else if(wt(n,"readystatechange"),ee(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=o===0){var i=String(n.I).match(_d)[1]||null;!i&&N.self&&N.self.location&&(i=N.self.location.protocol.slice(0,-1)),r=!xy.test(i?i.toLowerCase():"")}e=r}if(e)wt(n,"complete"),wt(n,"success");else{n.m=6;try{var s=2<ee(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Pd(n)}}finally{Es(n)}}}}function Es(n,t){if(n.g){Dd(n);let e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||wt(n,"ready");try{e.onreadystatechange=r}catch{}}}function Dd(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(N.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function ee(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<ee(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Sy(t)}};function Uh(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Rd:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Py(n){let t={};n=(n.g&&2<=ee(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Or(n[r]))continue;var e=ey(n[r]);let i=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[i]||[];t[i]=s,s.push(e)}Yp(t,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Vd(n){let t="";return ba(n,function(e,r){t+=r,t+=":",t+=e,t+=`\r
`}),t}function Ba(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=Vd(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):H(n,t,e))}function Nr(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function Nd(n){this.Ga=0,this.j=[],this.l=new gs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Nr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Nr("baseRetryDelayMs",5e3,n),this.hb=Nr("retryDelaySeedMs",1e4,n),this.eb=Nr("forwardChannelMaxRetries",2,n),this.xa=Nr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Ed(n&&n.concurrentRequestLimit),this.Ja=new Ey,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=Nd.prototype;A.ra=8;A.H=1;function ja(n){if(kd(n),n.H==3){var t=n.W++,e=pe(n.I);if(H(e,"SID",n.K),H(e,"RID",t),H(e,"TYPE","terminate"),ti(n,e),t=new Jr(n,n.l,t),t.L=2,t.A=vs(pe(e)),e=!1,N.navigator&&N.navigator.sendBeacon)try{e=N.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&N.Image&&(new Image().src=t.A,e=!0),e||(t.g=jd(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Yr(t)}Ud(n)}function Ts(n){n.g&&(za(n),n.g.cancel(),n.g=null)}function kd(n){Ts(n),n.u&&(N.clearTimeout(n.u),n.u=null),os(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&N.clearTimeout(n.m),n.m=null)}function As(n){if(!Td(n.i)&&!n.m){n.m=!0;var t=n.Na;Ur||nd(),Br||(Ur(),Br=!0),Na.add(t,n),n.C=0}}function Cy(n,t){return Ad(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Wr(It(n.Na,n,t),qd(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Jr(this,this.l,n),s=this.s;if(this.U&&(s?(s=Wh(s),Hh(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var r=this.j[e];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=Fd(this,i,t),e=pe(this.I),H(e,"RID",n),H(e,"CVER",22),this.F&&H(e,"X-HTTP-Session-Id",this.F),ti(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(Vd(s)))+"&"+t:this.o&&Ba(e,this.o,s)),qa(this.i,i),this.bb&&H(e,"TYPE","init"),this.P?(H(e,"$req",t),H(e,"SID","null"),i.aa=!0,wa(i,e,null)):wa(i,e,t),this.H=2}}else this.H==3&&(n?Bh(this,n):this.j.length==0||Td(this.i)||Bh(this))};function Bh(n,t){var e;t?e=t.m:e=n.W++;let r=pe(n.I);H(r,"SID",n.K),H(r,"RID",e),H(r,"AID",n.V),ti(n,r),n.o&&n.s&&Ba(r,n.o,n.s),e=new Jr(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=Fd(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),qa(n.i,e),wa(e,r,t)}function ti(n,t){n.na&&ba(n.na,function(e,r){H(t,r,e)}),n.h&&yd({},function(e,r){H(t,r,e)})}function Fd(n,t,e){e=Math.min(n.j.length,e);var r=n.h?It(n.h.Va,n.h,n):null;t:{var i=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<e;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Ty(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function Md(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Ur||nd(),Br||(Ur(),Br=!0),Na.add(t,n),n.A=0}}function Ga(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Wr(It(n.Ma,n),qd(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,Ld(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Wr(It(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,St(10),Ts(this),Ld(this))};function za(n){n.B!=null&&(N.clearTimeout(n.B),n.B=null)}function Ld(n){n.g=new Jr(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=pe(n.wa);H(t,"RID","rpc"),H(t,"SID",n.K),H(t,"AID",n.V),H(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(t,"TO",n.qa),H(t,"TYPE","xmlhttp"),ti(n,t),n.o&&n.s&&Ba(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=vs(pe(t)),e.u=null,e.S=!0,fd(e,n)}A.ib=function(){this.v!=null&&(this.v=null,Ts(this),Ga(this),St(19))};function os(n){n.v!=null&&(N.clearTimeout(n.v),n.v=null)}function Od(n,t){var e=null;if(n.g==t){os(n),za(n),n.g=null;var r=2}else if(Ia(n.i,t))e=t.F,Sd(n.i,t),r=1;else return;if(n.H!=0){if(t.i)if(r==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var i=n.C;r=ps(),wt(r,new ud(r,e)),As(n)}else Md(n);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&Cy(n,t)||r==2&&Ga(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),i){case 1:Xe(n,5);break;case 4:Xe(n,10);break;case 3:Xe(n,6);break;default:Xe(n,2)}}}function qd(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function Xe(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var r=It(n.pb,n);e||(e=new Ze("//www.google.com/images/cleardot.gif"),N.location&&N.location.protocol=="http"||is(e,"https"),vs(e)),Ay(e.toString(),r)}else St(2);n.H=0,n.h&&n.h.za(t),Ud(n),kd(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),St(2)):(this.l.info("Failed to ping google.com"),St(1))};function Ud(n){if(n.H=0,n.ma=[],n.h){let t=xd(n.i);(t.length!=0||n.j.length!=0)&&(Vh(n.ma,t),Vh(n.ma,n.j),n.i.i.length=0,Sa(n.j),n.j.length=0),n.h.ya()}}function Bd(n,t,e){var r=e instanceof Ze?pe(e):new Ze(e);if(r.g!="")t&&(r.g=t+"."+r.g),ss(r,r.m);else{var i=N.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Ze(null);r&&is(s,r),t&&(s.g=t),i&&ss(s,i),e&&(s.l=e),r=s}return e=n.F,t=n.Da,e&&t&&H(r,e,t),H(r,"VER",n.ra),ti(n,r),r}function jd(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new tt(new Xr({ob:e})):new tt(n.va),t.Oa(n.J),t}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function Gd(){}A=Gd.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function as(){if(Ln&&!(10<=Number(Qp)))throw Error("Environmental error: no available transport.")}as.prototype.g=function(n,t){return new Vt(n,t)};function Vt(n,t){mt.call(this),this.g=new Nd(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Or(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Or(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new qn(this)}gt(Vt,mt);Vt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;St(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=Bd(n,null,n.Y),As(n)};Vt.prototype.close=function(){ja(this.g)};Vt.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=Va(n),n=e);t.j.push(new wy(t.fb++,n)),t.H==3&&As(t)};Vt.prototype.N=function(){this.g.h=null,delete this.j,ja(this.g),delete this.g,Vt.$.N.call(this)};function zd(n){La.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}gt(zd,La);function Kd(){Oa.call(this),this.status=1}gt(Kd,Oa);function qn(n){this.g=n}gt(qn,Gd);qn.prototype.Ba=function(){wt(this.g,"a")};qn.prototype.Aa=function(n){wt(this.g,new zd(n))};qn.prototype.za=function(n){wt(this.g,new Kd)};qn.prototype.ya=function(){wt(this.g,"b")};function Dy(){this.blockSize=-1}function zt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}gt(zt,Dy);zt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function aa(n,t,e){e||(e=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(i=0;16>i;++i)r[i]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],i=n.g[2];var s=n.g[3],o=t+(s^e&(i^s))+r[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[3]+3250441966&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[7]+4249261313&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[11]+2304563134&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[15]+1236535329&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(e^i))+r[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[0]+3921069994&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[4]+3889429448&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[8]+1163531501&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[12]+2368359562&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(e^i^s)+r[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[14]+4259657740&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[10]+3200236656&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[6]+76029189&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[2]+3299628645&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(i^(e|~s))+r[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[5]+4237533241&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[1]+2240044497&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[13]+1309151649&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}zt.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=e;)aa(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){aa(this,r),i=0;break}}else for(;s<t;)if(r[i++]=n[s++],i==this.blockSize){aa(this,r),i=0;break}}this.h=i,this.i+=t};zt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};function K(n,t){this.h=t;for(var e=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==t||(e[i]=s,r=!1)}this.g=e}var Vy={};function Ka(n){return-128<=n&&128>n?zp(n,function(t){return new K([t|0],0>t?-1:0)}):new K([n|0],0>n?-1:0)}function ne(n){if(isNaN(n)||!isFinite(n))return Mn;if(0>n)return _t(ne(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=Ea;return new K(t,0)}function $d(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return _t($d(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=ne(Math.pow(t,8)),r=Mn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),t);8>s?(s=ne(Math.pow(t,s)),r=r.R(s).add(ne(o))):(r=r.R(e),r=r.add(ne(o)))}return r}var Ea=4294967296,Mn=Ka(0),Ta=Ka(1),jh=Ka(16777216);A=K.prototype;A.ea=function(){if(Ot(this))return-_t(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:Ea+r)*t,t*=Ea}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(ge(this))return"0";if(Ot(this))return"-"+_t(this).toString(n);for(var t=ne(Math.pow(n,6)),e=this,r="";;){var i=cs(e,t).g;e=us(e,i.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=i,ge(e))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function ge(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Ot(n){return n.h==-1}A.X=function(n){return n=us(this,n),Ot(n)?-1:ge(n)?0:1};function _t(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new K(e,~n.h).add(Ta)}A.abs=function(){return Ot(this)?_t(this):this};A.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,e[i]=o<<16|s}return new K(e,e[e.length-1]&-2147483648?-1:0)};function us(n,t){return n.add(_t(t))}A.R=function(n){if(ge(this)||ge(n))return Mn;if(Ot(this))return Ot(n)?_t(this).R(_t(n)):_t(_t(this).R(n));if(Ot(n))return _t(this.R(_t(n)));if(0>this.X(jh)&&0>n.X(jh))return ne(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;e[2*r+2*i]+=o*u,rs(e,2*r+2*i),e[2*r+2*i+1]+=s*u,rs(e,2*r+2*i+1),e[2*r+2*i+1]+=o*a,rs(e,2*r+2*i+1),e[2*r+2*i+2]+=s*a,rs(e,2*r+2*i+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new K(e,0)};function rs(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function kr(n,t){this.g=n,this.h=t}function cs(n,t){if(ge(t))throw Error("division by zero");if(ge(n))return new kr(Mn,Mn);if(Ot(n))return t=cs(_t(n),t),new kr(_t(t.g),_t(t.h));if(Ot(t))return t=cs(n,_t(t)),new kr(_t(t.g),t.h);if(30<n.g.length){if(Ot(n)||Ot(t))throw Error("slowDivide_ only works with positive integers.");for(var e=Ta,r=t;0>=r.X(n);)e=Gh(e),r=Gh(r);var i=kn(e,1),s=kn(r,1);for(r=kn(r,2),e=kn(e,2);!ge(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(e),s=o),r=kn(r,1),e=kn(e,1)}return t=us(n,i.R(t)),new kr(i,t)}for(i=Mn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=Math.ceil(Math.log(e)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=ne(e),o=s.R(t);Ot(o)||0<o.X(n);)e-=r,s=ne(e),o=s.R(t);ge(s)&&(s=Ta),i=i.add(s),n=us(n,o)}return new kr(i,n)}A.gb=function(n){return cs(this,n).h};A.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new K(e,this.h&n.h)};A.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new K(e,this.h|n.h)};A.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new K(e,this.h^n.h)};function Gh(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new K(e,n.h)}function kn(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,i=[],s=0;s<r;s++)i[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new K(i,n.h)}as.prototype.createWebChannel=as.prototype.g;Vt.prototype.send=Vt.prototype.u;Vt.prototype.open=Vt.prototype.m;Vt.prototype.close=Vt.prototype.close;ys.NO_ERROR=0;ys.TIMEOUT=8;ys.HTTP_ERROR=6;cd.COMPLETE="complete";ld.EventType=Hr;Hr.OPEN="a";Hr.CLOSE="b";Hr.ERROR="c";Hr.MESSAGE="d";mt.prototype.listen=mt.prototype.O;tt.prototype.listenOnce=tt.prototype.P;tt.prototype.getLastError=tt.prototype.Sa;tt.prototype.getLastErrorCode=tt.prototype.Ia;tt.prototype.getStatus=tt.prototype.da;tt.prototype.getResponseJson=tt.prototype.Wa;tt.prototype.getResponseText=tt.prototype.ja;tt.prototype.send=tt.prototype.ha;tt.prototype.setWithCredentials=tt.prototype.Oa;zt.prototype.digest=zt.prototype.l;zt.prototype.reset=zt.prototype.reset;zt.prototype.update=zt.prototype.j;K.prototype.add=K.prototype.add;K.prototype.multiply=K.prototype.R;K.prototype.modulo=K.prototype.gb;K.prototype.compare=K.prototype.X;K.prototype.toNumber=K.prototype.ea;K.prototype.toString=K.prototype.toString;K.prototype.getBits=K.prototype.D;K.fromNumber=ne;K.fromString=$d;var Qd=Kt.createWebChannelTransport=function(){return new as},Wd=Kt.getStatEventTarget=function(){return ps()},Ss=Kt.ErrorCode=ys,Hd=Kt.EventType=cd,Jd=Kt.Event=tn,$a=Kt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Yd=Kt.FetchXmlHttpFactory=Xr,ei=Kt.WebChannel=ld,Xd=Kt.XhrIo=tt,Zd=Kt.Md5=zt,en=Kt.Integer=K;var tf="@firebase/firestore";var lt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};lt.UNAUTHENTICATED=new lt(null),lt.GOOGLE_CREDENTIALS=new lt("google-credentials-uid"),lt.FIRST_PARTY=new lt("first-party-uid"),lt.MOCK_USER=new lt("mock-user");var pr="10.11.1";var Fe=new rh("@firebase/firestore");function zn(){return Fe.logLevel}function em(n){Fe.setLogLevel(n)}function _(n,...t){if(Fe.logLevel<=Zt.DEBUG){let e=t.map(Hc);Fe.debug(`Firestore (${pr}): ${n}`,...e)}}function rt(n,...t){if(Fe.logLevel<=Zt.ERROR){let e=t.map(Hc);Fe.error(`Firestore (${pr}): ${n}`,...e)}}function Ut(n,...t){if(Fe.logLevel<=Zt.WARN){let e=t.map(Hc);Fe.warn(`Firestore (${pr}): ${n}`,...e)}}function Hc(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function R(n="Unexpected state"){let t=`FIRESTORE (${pr}) INTERNAL ASSERTION FAILED: `+n;throw rt(t),new Error(t)}function P(n,t){n||R()}function nm(n,t){n||R()}function T(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends nh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ht=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Ms=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Ya=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(lt.UNAUTHENTICATED))}shutdown(){}},Xa=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Za=class{constructor(t){this.t=t,this.currentUser=lt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,i=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),s=new ht;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ht,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;t.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ht)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P(typeof r.accessToken=="string"),new Ms(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return P(t===null||typeof t=="string"),new lt(t)}},tu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=lt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},eu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new tu(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(lt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},nu=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ru=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(P(typeof e.token=="string"),this.R=e.token,new nu(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Ny(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var Ls=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=Ny(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%t.length))}return r}};function k(n,t){return n<t?-1:n>t?1:0}function Zn(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function rm(n){return n+"\0"}var X=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?k(this.nanoseconds,t.nanoseconds):k(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var C=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new X(0,0))}static max(){return new n(new X(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Os=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&R(),r===void 0?r=t.length-e:r>t.length-e&&R(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},q=class n extends Os{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},ky=/^[_a-zA-Z][_a-zA-Z0-9]*$/,it=class n extends Os{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return ky.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var I=class n{constructor(t){this.path=t}static fromPath(t){return new n(q.fromString(t))}static fromName(t){return new n(q.fromString(t).popFirst(5))}static empty(){return new n(q.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&q.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return q.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new q(t.slice()))}};var tr=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function iu(n){return n.fields.find(t=>t.kind===2)}function rn(n){return n.fields.filter(t=>t.kind!==2)}tr.UNKNOWN_ID=-1;var Jn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var fi=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,Bt.min())}};function im(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=C.fromTimestamp(r===1e9?new X(e+1,0):new X(e,r));return new Bt(i,I.empty(),t)}function sm(n){return new Bt(n.readTime,n.key,-1)}var Bt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(C.min(),I.empty(),-1)}static max(){return new n(C.max(),I.empty(),-1)}};function Jc(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=I.comparator(n.documentKey,t.documentKey),e!==0?e:k(n.largestBatchId,t.largestBatchId))}var om="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",qs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ke(n){return p(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==om)throw n;_("LocalStore","Unexpectedly lost primary lease")})}var f=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&e()},u=>r(u))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;e(t[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var Us=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new ht,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new ln(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Yc(r.target.error);this.V.reject(new ln(t,i))}}static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new ln(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(_("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new ou(e)}},Me=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(Vr())===12.2&&rt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _("SimpleDb","Removing database:",t),sn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!eh())return!1;if(n.C())return!0;let t=Vr(),e=n.S(t),r=0<e&&e<10,i=am(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(t){return p(this,null,function*(){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new ln(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ln(t,o))},i.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){return p(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(t);let a=Us.open(this.db,t,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),f.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function am(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var su=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return sn(this.B.delete())}},ln=class extends y{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function $e(n){return n.name==="IndexedDbTransactionError"}var ou=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(_("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),sn(r)}add(t){return _("SimpleDb","ADD",this.store.name,t,t),sn(this.store.add(t))}get(t){return sn(this.store.get(t)).next(e=>(e===void 0&&(e=null),_("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _("SimpleDb","DELETE",this.store.name,t),sn(this.store.delete(t))}count(){return _("SimpleDb","COUNT",this.store.name),sn(this.store.count())}U(t,e){let r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new f((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new f((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(t,e){_("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.W(i,e)}Y(t){let e=this.cursor({});return new f((r,i)=>{e.onerror=s=>{let o=Yc(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(t,e){let r=[];return new f((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new su(a),c=e(a.primaryKey,a.value,u);if(c instanceof f){let l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>f.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.H?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function sn(n){return new f((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=Yc(r.target.error);e(i)}})}var ef=!1;function Yc(n){let t=Me.S(Vr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ef||(ef=!0,setTimeout(()=>{throw r},0)),r}}return n}var au=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){_("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>p(this,null,function*(){this.task=null;try{_("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){$e(e)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Ke(e)}yield this.X(6e4)}))}},uu=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let r=new Set,i=e,s=!0;return f.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return _("IndexBackfiller",`Processing collection: ${o}`),this.ne(t,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>e-i)}ne(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.re(i,s)).next(a=>(_("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}re(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=sm(s);Jc(o,r)>0&&(r=o)}),new Bt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Nt=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function Fi(n){return n==null}function mi(n){return n===0&&1/n==-1/0}function um(n){return typeof n=="number"&&Number.isInteger(n)&&!mi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function xt(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=nf(t)),t=Fy(n.get(e),t);return nf(t)}function Fy(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function nf(n){return n+""}function re(n){let t=n.length;if(P(t>=2),t===2)return P(n.charAt(0)===""&&n.charAt(1)===""),q.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&R(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:R()}s=o+2}return new q(r)}var rf=["userId","batchId"];function Cs(n,t){return[n,xt(t)]}function cm(n,t,e){return[n,xt(t),e]}var My={},Ly=["prefixPath","collectionGroup","readTime","documentId"],Oy=["prefixPath","collectionGroup","documentId"],qy=["collectionGroup","readTime","prefixPath","documentId"],Uy=["canonicalId","targetId"],By=["targetId","path"],jy=["path","targetId"],Gy=["collectionId","parent"],zy=["indexId","uid"],Ky=["uid","sequenceNumber"],$y=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Qy=["indexId","uid","orderedDocumentKey"],Wy=["userId","collectionPath","documentId"],Hy=["userId","collectionPath","largestBatchId"],Jy=["userId","collectionGroup","largestBatchId"],lm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Yy=[...lm,"documentOverlays"],hm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],dm=hm,fm=[...dm,"indexConfiguration","indexState","indexEntries"],Xy=fm;var gi=class extends qs{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function yt(n,t){let e=T(n);return Me.F(e._e,t)}function sf(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function En(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function mm(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var J=class n{constructor(t,e){this.comparator=t,this.root=e||se.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,se.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,se.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Hn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Hn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Hn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Hn(this.root,t,this.comparator,!0)}},Hn=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},se=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw R();let t=this.left.check();if(t!==this.right.check())throw R();return t+(this.isRed()?0:1)}};se.EMPTY=null,se.RED=!0,se.BLACK=!1;se.EMPTY=new class{constructor(){this.size=0}get key(){throw R()}get value(){throw R()}get color(){throw R()}get left(){throw R()}get right(){throw R()}copy(t,e,r,i,s){return this}insert(t,e,r){return new se(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Q=class n{constructor(t){this.comparator=t,this.data=new J(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Bs(this.data.getIterator())}getIteratorFrom(t){return new Bs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Bs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Un(n){return n.hasNext()?n.getNext():void 0}var kt=class n{constructor(t){this.fields=t,t.sort(it.comparator)}static empty(){return new n([])}unionWith(t){let e=new Q(it.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zn(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var js=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function gm(){return typeof atob<"u"}var pt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new js("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return k(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};pt.EMPTY_BYTE_STRING=new pt("");var Zy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function we(n){if(P(!!n),typeof n=="string"){let t=0,e=Zy.exec(n);if(P(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:et(n.seconds),nanos:et(n.nanos)}}function et(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Le(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}function No(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Xc(n){let t=n.mapValue.fields.__previous_value__;return No(t)?Xc(t):t}function pi(n){let t=we(n.mapValue.fields.__local_write_time__.timestampValue);return new X(t.seconds,t.nanos)}var cu=class{constructor(t,e,r,i,s,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Oe=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Ne={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ds={nullValue:"NULL_VALUE"};function hn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?No(n)?4:pm(n)?9007199254740991:10:R()}function ue(n,t){if(n===t)return!0;let e=hn(n);if(e!==hn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return pi(n).isEqual(pi(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=we(i.timestampValue),a=we(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return Le(i.bytesValue).isEqual(Le(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return et(i.geoPointValue.latitude)===et(s.geoPointValue.latitude)&&et(i.geoPointValue.longitude)===et(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return et(i.integerValue)===et(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=et(i.doubleValue),a=et(s.doubleValue);return o===a?mi(o)===mi(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return Zn(n.arrayValue.values||[],t.arrayValue.values||[],ue);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(sf(o)!==sf(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!ue(o[u],a[u])))return!1;return!0}(n,t);default:return R()}}function yi(n,t){return(n.values||[]).find(e=>ue(e,t))!==void 0}function qe(n,t){if(n===t)return 0;let e=hn(n),r=hn(t);if(e!==r)return k(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return k(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=et(s.integerValue||s.doubleValue),u=et(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return of(n.timestampValue,t.timestampValue);case 4:return of(pi(n),pi(t));case 5:return k(n.stringValue,t.stringValue);case 6:return function(s,o){let a=Le(s),u=Le(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=k(a[c],u[c]);if(l!==0)return l}return k(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=k(et(s.latitude),et(o.latitude));return a!==0?a:k(et(s.longitude),et(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=qe(a[c],u[c]);if(l)return l}return k(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Ne.mapValue&&o===Ne.mapValue)return 0;if(s===Ne.mapValue)return 1;if(o===Ne.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=k(u[h],l[h]);if(d!==0)return d;let m=qe(a[u[h]],c[l[h]]);if(m!==0)return m}return k(u.length,l.length)}(n.mapValue,t.mapValue);default:throw R()}}function of(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return k(n,t);let e=we(n),r=we(t),i=k(e.seconds,r.seconds);return i!==0?i:k(e.nanos,r.nanos)}function er(n){return lu(n)}function lu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=we(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Le(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return I.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=lu(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${lu(e.fields[o])}`;return i+"}"}(n.mapValue):R()}function dn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function hu(n){return!!n&&"integerValue"in n}function _i(n){return!!n&&"arrayValue"in n}function af(n){return!!n&&"nullValue"in n}function uf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Vs(n){return!!n&&"mapValue"in n}function ui(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return En(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ui(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ui(n.arrayValue.values[e]);return t}return Object.assign({},n)}function pm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function t_(n){return"nullValue"in n?Ds:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?dn(Oe.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:R()}function e_(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?dn(Oe.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ne:R()}function cf(n,t){let e=qe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function lf(n,t){let e=qe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var At=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Vs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ui(e)}setAll(t){let e=it.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let u=this.getFieldsMap(e);this.applyChanges(u,r,i),r={},i=[],e=a.popLast()}o?r[a.lastSegment()]=ui(o):i.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());Vs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ue(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Vs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){En(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(ui(this.value))}};function ym(n){let t=[];return En(n.fields,(e,r)=>{let i=new it([e]);if(Vs(r)){let s=ym(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new kt(t)}var dt=class n{constructor(t,e,r,i,s,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,C.min(),C.min(),C.min(),At.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,C.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,C.min(),C.min(),At.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,C.min(),C.min(),At.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(C.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ce=class{constructor(t,e){this.position=t,this.inclusive=e}};function hf(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),e.key):r=qe(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function df(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ue(n.position[e],t.position[e]))return!1;return!0}var fn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function n_(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Gs=class{},L=class n extends Gs{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new mu(t,e,r):e==="array-contains"?new yu(t,r):e==="in"?new zs(t,r):e==="not-in"?new _u(t,r):e==="array-contains-any"?new wu(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new gu(t,r):new pu(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(qe(e,this.value)):e!==null&&hn(this.value)===hn(e)&&this.matchesComparison(qe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return R()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},$=class n extends Gs{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return nr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function nr(n){return n.op==="and"}function du(n){return n.op==="or"}function Zc(n){return _m(n)&&nr(n)}function _m(n){for(let t of n.filters)if(t instanceof $)return!1;return!0}function fu(n){if(n instanceof L)return n.field.canonicalString()+n.op.toString()+er(n.value);if(Zc(n))return n.filters.map(t=>fu(t)).join(",");{let t=n.filters.map(e=>fu(e)).join(",");return`${n.op}(${t})`}}function wm(n,t){return n instanceof L?function(r,i){return i instanceof L&&r.op===i.op&&r.field.isEqual(i.field)&&ue(r.value,i.value)}(n,t):n instanceof $?function(r,i){return i instanceof $&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&wm(o,i.filters[a]),!0):!1}(n,t):void R()}function vm(n,t){let e=n.filters.concat(t);return $.create(e,n.op)}function Im(n){return n instanceof L?function(e){return`${e.field.canonicalString()} ${e.op} ${er(e.value)}`}(n):n instanceof $?function(e){return e.op.toString()+" {"+e.getFilters().map(Im).join(" ,")+"}"}(n):"Filter"}var mu=class extends L{constructor(t,e,r){super(t,e,r),this.key=I.fromName(r.referenceValue)}matches(t){let e=I.comparator(t.key,this.key);return this.matchesComparison(e)}},gu=class extends L{constructor(t,e){super(t,"in",e),this.keys=Em("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},pu=class extends L{constructor(t,e){super(t,"not-in",e),this.keys=Em("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Em(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>I.fromName(r.referenceValue))}var yu=class extends L{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return _i(e)&&yi(e.arrayValue,this.value)}},zs=class extends L{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&yi(this.value.arrayValue,e)}},_u=class extends L{constructor(t,e){super(t,"not-in",e)}matches(t){if(yi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!yi(this.value.arrayValue,e)}},wu=class extends L{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!_i(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>yi(this.value.arrayValue,r))}};var vu=class{constructor(t,e=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Iu(n,t=null,e=[],r=[],i=null,s=null,o=null){return new vu(n,t,e,r,i,s,o)}function mn(n){let t=T(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>fu(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Fi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>er(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>er(r)).join(",")),t.ue=e}return t.ue}function Mi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!n_(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!wm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!df(n.startAt,t.startAt)&&df(n.endAt,t.endAt)}function Ks(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $s(n,t){return n.filters.filter(e=>e instanceof L&&e.field.isEqual(t))}function ff(n,t,e){let r=Ds,i=!0;for(let s of $s(n,t)){let o=Ds,a=!0;switch(s.op){case"<":case"<=":o=t_(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ds}cf({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];cf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function mf(n,t,e){let r=Ne,i=!0;for(let s of $s(n,t)){let o=Ne,a=!0;switch(s.op){case">=":case">":o=e_(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ne}lf({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];lf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var $t=class{constructor(t,e=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Tm(n,t,e,r,i,s,o,a){return new $t(n,t,e,r,i,s,o,a)}function yr(n){return new $t(n)}function gf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function tl(n){return n.collectionGroup!==null}function Yn(n){let t=T(n);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Q(it.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new fn(s,r))}),e.has(it.keyField().canonicalString())||t.ce.push(new fn(it.keyField(),r))}return t.ce}function bt(n){let t=T(n);return t.le||(t.le=r_(t,Yn(n))),t.le}function r_(n,t){if(n.limitType==="F")return Iu(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fn(i.field,s)});let e=n.endAt?new ce(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ce(n.startAt.position,n.startAt.inclusive):null;return Iu(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Eu(n,t){let e=n.filters.concat([t]);return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Qs(n,t,e){return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Li(n,t){return Mi(bt(n),bt(t))&&n.limitType===t.limitType}function Am(n){return`${mn(bt(n))}|lt:${n.limitType}`}function Kn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>Im(i)).join(", ")}]`),Fi(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>er(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>er(i)).join(",")),`Target(${r})`}(bt(n))}; limitType=${n.limitType})`}function Oi(n,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(let s of Yn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=hf(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Yn(r),i)||r.endAt&&!function(o,a,u){let c=hf(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Yn(r),i))}(n,t)}function Sm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function xm(n){return(t,e)=>{let r=!1;for(let i of Yn(n)){let s=i_(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function i_(n,t,e){let r=n.field.isKeyField()?I.comparator(t.key,e.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?qe(u,c):R()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}var le=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){En(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return mm(this.inner)}size(){return this.innerSize}};var s_=new J(I.comparator);function Ct(){return s_}var bm=new J(I.comparator);function oi(...n){let t=bm;for(let e of n)t=t.insert(e.key,e);return t}function Rm(n){let t=bm;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ie(){return ci()}function Pm(){return ci()}function ci(){return new le(n=>n.toString(),(n,t)=>n.isEqual(t))}var o_=new J(I.comparator),a_=new Q(I.comparator);function F(...n){let t=a_;for(let e of n)t=t.add(e);return t}var u_=new Q(k);function el(){return u_}function Cm(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mi(t)?"-0":t}}function Dm(n){return{integerValue:""+n}}function Vm(n,t){return um(t)?Dm(t):Cm(n,t)}var rr=class{constructor(){this._=void 0}};function c_(n,t,e){return n instanceof Ue?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&No(s)&&(s=Xc(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof ve?km(n,t):n instanceof Ie?Fm(n,t):function(i,s){let o=Nm(i,s),a=pf(o)+pf(i.Pe);return hu(o)&&hu(i.Pe)?Dm(a):Cm(i.serializer,a)}(n,t)}function l_(n,t,e){return n instanceof ve?km(n,t):n instanceof Ie?Fm(n,t):e}function Nm(n,t){return n instanceof Be?function(r){return hu(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var Ue=class extends rr{},ve=class extends rr{constructor(t){super(),this.elements=t}};function km(n,t){let e=Mm(t);for(let r of n.elements)e.some(i=>ue(i,r))||e.push(r);return{arrayValue:{values:e}}}var Ie=class extends rr{constructor(t){super(),this.elements=t}};function Fm(n,t){let e=Mm(t);for(let r of n.elements)e=e.filter(i=>!ue(i,r));return{arrayValue:{values:e}}}var Be=class extends rr{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function pf(n){return et(n.integerValue||n.doubleValue)}function Mm(n){return _i(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var gn=class{constructor(t,e){this.field=t,this.transform=e}};function h_(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof ve&&i instanceof ve||r instanceof Ie&&i instanceof Ie?Zn(r.elements,i.elements,ue):r instanceof Be&&i instanceof Be?ue(r.Pe,i.Pe):r instanceof Ue&&i instanceof Ue}(n.transform,t.transform)}var Tu=class{constructor(t,e){this.version=t,this.transformResults=e}},nt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ns(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var ir=class{};function Lm(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Ge(n.key,nt.none()):new je(n.key,n.data,nt.none());{let e=n.data,r=At.empty(),i=new Q(it.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Qt(n.key,r,new kt(i.toArray()),nt.none())}}function d_(n,t,e){n instanceof je?function(i,s,o){let a=i.value.clone(),u=_f(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Qt?function(i,s,o){if(!Ns(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=_f(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Om(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function li(n,t,e,r){return n instanceof je?function(s,o,a,u){if(!Ns(s.precondition,o))return a;let c=s.value.clone(),l=wf(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Qt?function(s,o,a,u){if(!Ns(s.precondition,o))return a;let c=wf(s.fieldTransforms,u,o),l=o.data;return l.setAll(Om(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,r):function(s,o,a){return Ns(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function f_(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=Nm(r.transform,i||null);s!=null&&(e===null&&(e=At.empty()),e.set(r.field,s))}return e||null}function yf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Zn(r,i,(s,o)=>h_(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var je=class extends ir{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Qt=class extends ir{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Om(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function _f(n,t,e){let r=new Map;P(n.length===e.length);for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,l_(o,a,e[i]))}return r}function wf(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,c_(s,o,t))}return r}var Ge=class extends ir{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},wi=class extends ir{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vi=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&d_(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=li(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=li(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Pm();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(i.key)?null:a;let u=Lm(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(C.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),F())}isEqual(t){return this.batchId===t.batchId&&Zn(this.mutations,t.mutations,(e,r)=>yf(e,r))&&Zn(this.baseMutations,t.baseMutations,(e,r)=>yf(e,r))}},Au=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){P(t.mutations.length===r.length);let i=function(){return o_}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var Ii=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Su=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ut,O;function qm(n){switch(n){default:return R();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Um(n){if(n===void 0)return rt("GRPC error has no .code"),g.UNKNOWN;switch(n){case ut.OK:return g.OK;case ut.CANCELLED:return g.CANCELLED;case ut.UNKNOWN:return g.UNKNOWN;case ut.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case ut.INTERNAL:return g.INTERNAL;case ut.UNAVAILABLE:return g.UNAVAILABLE;case ut.UNAUTHENTICATED:return g.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case ut.NOT_FOUND:return g.NOT_FOUND;case ut.ALREADY_EXISTS:return g.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return g.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case ut.ABORTED:return g.ABORTED;case ut.OUT_OF_RANGE:return g.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return g.UNIMPLEMENTED;case ut.DATA_LOSS:return g.DATA_LOSS;default:return R()}}(O=ut||(ut={}))[O.OK=0]="OK",O[O.CANCELLED=1]="CANCELLED",O[O.UNKNOWN=2]="UNKNOWN",O[O.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",O[O.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",O[O.NOT_FOUND=5]="NOT_FOUND",O[O.ALREADY_EXISTS=6]="ALREADY_EXISTS",O[O.PERMISSION_DENIED=7]="PERMISSION_DENIED",O[O.UNAUTHENTICATED=16]="UNAUTHENTICATED",O[O.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",O[O.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",O[O.ABORTED=10]="ABORTED",O[O.OUT_OF_RANGE=11]="OUT_OF_RANGE",O[O.UNIMPLEMENTED=12]="UNIMPLEMENTED",O[O.INTERNAL=13]="INTERNAL",O[O.UNAVAILABLE=14]="UNAVAILABLE",O[O.DATA_LOSS=15]="DATA_LOSS";var vf=null;function Bm(){return new TextEncoder}var m_=new en([4294967295,4294967295],0);function If(n){let t=Bm().encode(n),e=new Zd;return e.update(t),new Uint8Array(e.digest())}function Ef(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new en([e,r],0),new en([i,s],0)]}var xu=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new cn(`Invalid padding: ${e}`);if(r<0)throw new cn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new cn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new cn(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=en.fromNumber(this.Ie)}Ee(t,e,r){let i=t.add(e.multiply(en.fromNumber(r)));return i.compare(m_)===1&&(i=new en([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=If(t),[r,i]=Ef(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Ie===0)return;let e=If(t),[r,i]=Ef(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},cn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ei=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,Ti.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(C.min(),i,new J(k),Ct(),F())}},Ti=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,F(),F(),F())}};var Xn=class{constructor(t,e,r,i){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=i}},Ws=class{constructor(t,e){this.targetId=t,this.me=e}},Hs=class{constructor(t,e,r=pt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},Js=class{constructor(){this.fe=0,this.ge=Af(),this.pe=pt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=F(),e=F(),r=F();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:R()}}),new Ti(this.pe,this.ye,t,e,r)}ve(){this.we=!1,this.ge=Af()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,P(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},bu=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Ct(),this.qe=Tf(),this.Qe=new J(k)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let r=this.Ge(e);switch(t.state){case 0:this.ze(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),r.De(t.resumeToken));break;default:R()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((r,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,r=t.me.count,i=this.Je(e);if(i){let s=i.target;if(Ks(s))if(r===0){let o=new I(s.path);this.Ue(e,o,dt.newNoDocument(o,C.min()))}else P(r===1);else{let o=this.Ye(e);if(o!==r){let a=this.Ze(t),u=a?this.Xe(a,t,o):1;if(u!==0){this.je(e);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,c)}vf?.et(function(l,h,d,m,S){var w,v,D,M,V,j;let G={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},B=h.unchangedNames;return B&&(G.bloomFilter={applied:S===0,hashCount:(w=B?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(M=(D=(v=B?.bits)===null||v===void 0?void 0:v.bitmap)===null||D===void 0?void 0:D.length)!==null&&M!==void 0?M:0,padding:(j=(V=B?.bits)===null||V===void 0?void 0:V.padding)!==null&&j!==void 0?j:0,mightContain:ot=>{var Jt;return(Jt=m?.mightContain(ot))!==null&&Jt!==void 0&&Jt}}),G}(o,t.me,this.Le.tt(),a,u))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,a;try{o=Le(r).toUint8Array()}catch(u){if(u instanceof js)return Ut("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new xu(o,i,s)}catch(u){return Ut(u instanceof cn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(t,e,r){return e.me.count===r-this.nt(t,e.targetId)?0:2}nt(t,e){let r=this.Le.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Ks(a.target)){let u=new I(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,dt.newNoDocument(u,t))}s.be&&(e.set(o,s.Ce()),s.ve())}});let r=F();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(t));let i=new Ei(t,e,this.Qe,this.ke,r);return this.ke=Ct(),this.qe=Tf(),this.Qe=new J(k),i}$e(t,e){if(!this.ze(t))return;let r=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,r){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Js,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Q(k),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||_("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Js),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function Tf(){return new J(I.comparator)}function Af(){return new J(I.comparator)}var g_={asc:"ASCENDING",desc:"DESCENDING"},p_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},y_={and:"AND",or:"OR"},Ru=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Pu(n,t){return n.useProto3Json||Fi(t)?t:{value:t}}function sr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function jm(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function __(n,t){return sr(n,t.toTimestamp())}function st(n){return P(!!n),C.fromTimestamp(function(e){let r=we(e);return new X(r.seconds,r.nanos)}(n))}function nl(n,t){return Cu(n,t).canonicalString()}function Cu(n,t){let e=function(i){return new q(["projects",i.projectId,"databases",i.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Gm(n){let t=q.fromString(n);return P(Zm(t)),t}function Ai(n,t){return nl(n.databaseId,t.path)}function oe(n,t){let e=Gm(t);if(e.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new I($m(e))}function zm(n,t){return nl(n.databaseId,t)}function Km(n){let t=Gm(n);return t.length===4?q.emptyPath():$m(t)}function Du(n){return new q(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $m(n){return P(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Sf(n,t,e){return{name:Ai(n,t),fields:e.value.mapValue.fields}}function Qm(n,t,e){let r=oe(n,t.name),i=st(t.updateTime),s=t.createTime?st(t.createTime):C.min(),o=new At({mapValue:{fields:t.fields}}),a=dt.newFoundDocument(r,i,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function w_(n,t){return"found"in t?function(r,i){P(!!i.found),i.found.name,i.found.updateTime;let s=oe(r,i.found.name),o=st(i.found.updateTime),a=i.found.createTime?st(i.found.createTime):C.min(),u=new At({mapValue:{fields:i.found.fields}});return dt.newFoundDocument(s,o,a,u)}(n,t):"missing"in t?function(r,i){P(!!i.missing),P(!!i.readTime);let s=oe(r,i.missing),o=st(i.readTime);return dt.newNoDocument(s,o)}(n,t):R()}function v_(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:R()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(l===void 0||typeof l=="string"),pt.fromBase64String(l||"")):(P(l===void 0||l instanceof Buffer||l instanceof Uint8Array),pt.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:Um(c.code);return new y(l,c.message||"")}(o);e=new Hs(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=oe(n,r.document.name),s=st(r.document.updateTime),o=r.document.createTime?st(r.document.createTime):C.min(),a=new At({mapValue:{fields:r.document.fields}}),u=dt.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];e=new Xn(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=oe(n,r.document),s=r.readTime?st(r.readTime):C.min(),o=dt.newNoDocument(i,s),a=r.removedTargetIds||[];e=new Xn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=oe(n,r.document),s=r.removedTargetIds||[];e=new Xn([],s,i,null)}else{if(!("filter"in t))return R();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Su(i,s),a=r.targetId;e=new Ws(a,o)}}return e}function Si(n,t){let e;if(t instanceof je)e={update:Sf(n,t.key,t.value)};else if(t instanceof Ge)e={delete:Ai(n,t.key)};else if(t instanceof Qt)e={update:Sf(n,t.key,t.data),updateMask:x_(t.fieldMask)};else{if(!(t instanceof wi))return R();e={verify:Ai(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Ue)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ve)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ie)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Be)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw R()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:__(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:R()}(n,t.precondition)),e}function Vu(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?nt.updateTime(st(s.updateTime)):s.exists!==void 0?nt.exists(s.exists):nt.none()}(t.currentDocument):nt.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)P(a.setToServerValue==="REQUEST_TIME"),u=new Ue;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new ve(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Ie(l)}else"increment"in a?u=new Be(o,a.increment):R();let c=it.fromServerFormat(a.fieldPath);return new gn(c,u)}(n,i)):[];if(t.update){t.update.name;let i=oe(n,t.update.name),s=new At({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(u){let c=u.fieldPaths||[];return new kt(c.map(l=>it.fromServerFormat(l)))}(t.updateMask);return new Qt(i,s,o,e,r)}return new je(i,s,e,r)}if(t.delete){let i=oe(n,t.delete);return new Ge(i,e)}if(t.verify){let i=oe(n,t.verify);return new wi(i,e)}return R()}function I_(n,t){return n&&n.length>0?(P(t!==void 0),n.map(e=>function(i,s){let o=i.updateTime?st(i.updateTime):st(s);return o.isEqual(C.min())&&(o=st(s)),new Tu(o,i.transformResults||[])}(e,t))):[]}function Wm(n,t){return{documents:[zm(n,t.path)]}}function Hm(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=zm(n,i);let s=function(c){if(c.length!==0)return Xm($.create(c,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:$n(d.field),direction:T_(d.dir)}}(l))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=Pu(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{_t:e,parent:i}}function Jm(n){let t=Km(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){P(r===1);let l=e.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){let d=Ym(h);return d instanceof $&&Zc(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(S){return new fn(Qn(S.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Fi(d)?null:d}(e.limit));let u=null;e.startAt&&(u=function(h){let d=!!h.before,m=h.values||[];return new ce(m,d)}(e.startAt));let c=null;return e.endAt&&(c=function(h){let d=!h.before,m=h.values||[];return new ce(m,d)}(e.endAt)),Tm(t,i,o,s,a,"F",u,c)}function E_(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ym(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Qn(e.unaryFilter.field);return L.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Qn(e.unaryFilter.field);return L.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Qn(e.unaryFilter.field);return L.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Qn(e.unaryFilter.field);return L.create(o,"!=",{nullValue:"NULL_VALUE"});default:return R()}}(n):n.fieldFilter!==void 0?function(e){return L.create(Qn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return $.create(e.compositeFilter.filters.map(r=>Ym(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return R()}}(e.compositeFilter.op))}(n):R()}function T_(n){return g_[n]}function A_(n){return p_[n]}function S_(n){return y_[n]}function $n(n){return{fieldPath:n.canonicalString()}}function Qn(n){return it.fromServerFormat(n.fieldPath)}function Xm(n){return n instanceof L?function(e){if(e.op==="=="){if(uf(e.value))return{unaryFilter:{field:$n(e.field),op:"IS_NAN"}};if(af(e.value))return{unaryFilter:{field:$n(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(uf(e.value))return{unaryFilter:{field:$n(e.field),op:"IS_NOT_NAN"}};if(af(e.value))return{unaryFilter:{field:$n(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$n(e.field),op:A_(e.op),value:e.value}}}(n):n instanceof $?function(e){let r=e.getFilters().map(i=>Xm(i));return r.length===1?r[0]:{compositeFilter:{op:S_(e.op),filters:r}}}(n):R()}function x_(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Zm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var or=class n{constructor(t,e,r,i,s=C.min(),o=C.min(),a=pt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Ys=class{constructor(t){this.ut=t}};function b_(n,t){let e;if(t.document)e=Qm(n.ut,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=I.fromSegments(t.noDocument.path),i=yn(t.noDocument.readTime);e=dt.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return R();{let r=I.fromSegments(t.unknownDocument.path),i=yn(t.unknownDocument.version);e=dt.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){let s=new X(i[0],i[1]);return C.fromTimestamp(s)}(t.readTime)),e}function xf(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Xs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(s,o){return{name:Ai(s,o.key),fields:o.data.value.mapValue.fields,updateTime:sr(s,o.version.toTimestamp()),createTime:sr(s,o.createTime.toTimestamp())}}(n.ut,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:pn(t.version)};else{if(!t.isUnknownDocument())return R();r.unknownDocument={path:e.path.toArray(),version:pn(t.version)}}return r}function Xs(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function pn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function yn(n){let t=new X(n.seconds,n.nanoseconds);return C.fromTimestamp(t)}function on(n,t){let e=(t.baseMutations||[]).map(s=>Vu(n.ut,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let a=t.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>Vu(n.ut,s)),i=X.fromMillis(t.localWriteTimeMs);return new vi(t.batchId,i,e,r)}function ai(n){let t=yn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?yn(n.lastLimboFreeSnapshotVersion):C.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return P(s.documents.length===1),bt(yr(Km(s.documents[0])))}(n.query):function(s){return bt(Jm(s))}(n.query),new or(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,pt.fromBase64String(n.resumeToken))}function tg(n,t){let e=pn(t.snapshotVersion),r=pn(t.lastLimboFreeSnapshotVersion),i;i=Ks(t.target)?Wm(n.ut,t.target):Hm(n.ut,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:mn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function rl(n){let t=Jm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Qs(t,t.limit,"L"):t}function Qa(n,t){return new Ii(t.largestBatchId,Vu(n.ut,t.overlayMutation))}function bf(n,t){let e=t.path.lastSegment();return[n,xt(t.path.popLast()),e]}function Rf(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:pn(r.readTime),documentKey:xt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Nu=class{getBundleMetadata(t,e){return Pf(t).get(e).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:yn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(t,e){return Pf(t).put(function(i){return{bundleId:i.id,createTime:pn(st(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return Cf(t).get(e).next(r=>{if(r)return function(s){return{name:s.name,query:rl(s.bundledQuery),readTime:yn(s.readTime)}}(r)})}saveNamedQuery(t,e){return Cf(t).put(function(i){return{name:i.name,readTime:pn(st(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Pf(n){return yt(n,"bundles")}function Cf(n){return yt(n,"namedQueries")}var Zs=class n{constructor(t,e){this.serializer=t,this.userId=e}static ct(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return ni(t).get(bf(this.userId,e)).next(r=>r?Qa(this.serializer,r):null)}getOverlays(t,e){let r=ie();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let a=new Ii(e,o);i.push(this.lt(t,a))}),f.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(xt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ni(t).j("collectionPathOverlayIndex",a))}),f.waitFor(s)}getOverlaysForCollection(t,e,r){let i=ie(),s=xt(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ni(t).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Qa(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=ie(),o,a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ni(t).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Qa(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(t,e){return ni(t).put(function(i,s,o){let[a,u,c]=bf(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Si(i.ut,o.mutation)}}(this.serializer,this.userId,e))}};function ni(n){return yt(n,"documentOverlays")}var ye=class{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(et(t.integerValue));else if("doubleValue"in t){let r=et(t.doubleValue);isNaN(r)?this.Tt(e,13):(this.Tt(e,15),mi(r)?e.Et(0):e.Et(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Tt(e,20),typeof r=="string"&&(r=we(r)),e.dt(`${r.seconds||""}`),e.Et(r.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(Le(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Tt(e,45),e.Et(r.latitude||0),e.Et(r.longitude||0)}else"mapValue"in t?pm(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):R()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){let r=t.fields||{};this.Tt(e,55);for(let i of Object.keys(r))this.At(i,e),this.Pt(r[i],e)}yt(t,e){let r=t.values||[];this.Tt(e,50);for(let i of r)this.Pt(i,e)}ft(t,e){this.Tt(e,37),I.fromName(t).path.forEach(r=>{this.Tt(e,60),this.wt(r,e)})}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}};ye.St=new ye;function R_(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function Df(n){let t=64-function(r){let i=0;for(let s=0;s<8;++s){let o=R_(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(t/8)}var ku=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Dt(r.value),r=e.next();this.Ct()}vt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ft(r.value),r=e.next();this.Mt()}xt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=e.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(t){let e=this.Lt(t),r=Df(e);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}kt(t){let e=this.Lt(t),r=Df(e);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(t){this.Bt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ut(){return this.buffer.slice(0,this.position)}Lt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Dt(t){let e=255&t;e===0?(this.Qt(0),this.Qt(255)):e===255?(this.Qt(255),this.Qt(0)):this.Qt(e)}Ft(t){let e=255&t;e===0?(this.$t(0),this.$t(255)):e===255?(this.$t(255),this.$t(0)):this.$t(t)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(t){this.Bt(1),this.buffer[this.position++]=t}$t(t){this.Bt(1),this.buffer[this.position++]=~t}Bt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Fu=class{constructor(t){this.Wt=t}Vt(t){this.Wt.bt(t)}dt(t){this.Wt.xt(t)}Et(t){this.Wt.Nt(t)}It(){this.Wt.qt()}},Mu=class{constructor(t){this.Wt=t}Vt(t){this.Wt.vt(t)}dt(t){this.Wt.Ot(t)}Et(t){this.Wt.kt(t)}It(){this.Wt.Kt()}},an=class{constructor(){this.Wt=new ku,this.Gt=new Fu(this.Wt),this.zt=new Mu(this.Wt)}seed(t){this.Wt.seed(t)}jt(t){return t===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var un=class n{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Ht(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Pe(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=Vf(n.arrayValue,t.arrayValue),e!==0?e:(e=Vf(n.directionalValue,t.directionalValue),e!==0?e:I.comparator(n.documentKey,t.documentKey)))}function Vf(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var to=class{constructor(t){this.Jt=new Q((e,r)=>it.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Yt=t.orderBy,this.Zt=[];for(let e of t.filters){let r=e;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(t){if(P(t.collectionGroup===this.collectionId),this.Xt)return!1;let e=iu(t);if(e!==void 0&&!this.tn(e))return!1;let r=rn(t),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let t=new Q(it.comparator),e=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new Jn(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new Jn(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new Jn(r.field,r.dir==="asc"?0:1)));return new tr(tr.UNKNOWN_ID,this.collectionId,e,fi.empty())}tn(t){for(let e of this.Zt)if(this.nn(e,t))return!0;return!1}nn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}rn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function eg(n){var t,e;if(P(n instanceof L||n instanceof $),n instanceof L){if(n instanceof zs){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>L.create(n.field,"==",s)))||[];return $.create(i,"or")}return n}let r=n.filters.map(i=>eg(i));return $.create(r,n.op)}function P_(n){if(n.getFilters().length===0)return[];let t=qu(eg(n));return P(ng(t)),Lu(t)||Ou(t)?[t]:t.getFilters()}function Lu(n){return n instanceof L}function Ou(n){return n instanceof $&&Zc(n)}function ng(n){return Lu(n)||Ou(n)||function(e){if(e instanceof $&&du(e)){for(let r of e.getFilters())if(!Lu(r)&&!Ou(r))return!1;return!0}return!1}(n)}function qu(n){if(P(n instanceof L||n instanceof $),n instanceof L)return n;if(n.filters.length===1)return qu(n.filters[0]);let t=n.filters.map(r=>qu(r)),e=$.create(t,n.op);return e=eo(e),ng(e)?e:(P(e instanceof $),P(nr(e)),P(e.filters.length>1),e.filters.reduce((r,i)=>il(r,i)))}function il(n,t){let e;return P(n instanceof L||n instanceof $),P(t instanceof L||t instanceof $),e=n instanceof L?t instanceof L?function(i,s){return $.create([i,s],"and")}(n,t):Nf(n,t):t instanceof L?Nf(t,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),nr(i)&&nr(s))return vm(i,s.getFilters());let o=du(i)?i:s,a=du(i)?s:i,u=o.filters.map(c=>il(c,a));return $.create(u,"or")}(n,t),eo(e)}function Nf(n,t){if(nr(t))return vm(t,n.getFilters());{let e=t.filters.map(r=>il(n,r));return $.create(e,"or")}}function eo(n){if(P(n instanceof L||n instanceof $),n instanceof L)return n;let t=n.getFilters();if(t.length===1)return eo(t[0]);if(_m(n))return n;let e=t.map(i=>eo(i)),r=[];return e.forEach(i=>{i instanceof L?r.push(i):i instanceof $&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:$.create(r,n.op)}var Uu=class{constructor(){this.on=new xi}addToCollectionParentIndex(t,e){return this.on.add(e),f.resolve()}getCollectionParents(t,e){return f.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return f.resolve()}deleteFieldIndex(t,e){return f.resolve()}deleteAllFieldIndexes(t){return f.resolve()}createTargetIndexes(t,e){return f.resolve()}getDocumentsMatchingTarget(t,e){return f.resolve(null)}getIndexType(t,e){return f.resolve(0)}getFieldIndexes(t,e){return f.resolve([])}getNextCollectionGroupToUpdate(t){return f.resolve(null)}getMinOffset(t,e){return f.resolve(Bt.min())}getMinOffsetFromCollectionGroup(t,e){return f.resolve(Bt.min())}updateCollectionGroup(t,e,r){return f.resolve()}updateIndexEntries(t,e){return f.resolve()}},xi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new Q(q.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new Q(q.comparator)).toArray()}};var xs=new Uint8Array(0),Bu=class{constructor(t,e){this.databaseId=e,this._n=new xi,this.an=new le(r=>mn(r),(r,i)=>Mi(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this._n.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this._n.add(e)});let s={collectionId:r,parent:xt(i)};return kf(t).put(s)}return f.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[rm(e),""],!1,!0);return kf(t).U(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(re(o.parent))}return r})}addFieldIndex(t,e){let r=ri(t),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=jn(t);return s.next(a=>{o.put(Rf(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=ri(t),i=jn(t),s=Bn(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=ri(t),r=Bn(t),i=jn(t);return e.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(t,e){return f.forEach(this.un(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new to(r).sn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=Bn(t),i=!0,s=new Map;return f.forEach(this.un(e),o=>this.cn(t,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=F(),a=[];return f.forEach(s,(u,c)=>{_("IndexedDbIndexManager",`Using index ${function(V){return`id=${V.indexId}|cg=${V.collectionGroup}|f=${V.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${mn(e)}`);let l=function(V,j){let G=iu(j);if(G===void 0)return null;for(let B of $s(V,G.fieldPath))switch(B.op){case"array-contains-any":return B.value.arrayValue.values||[];case"array-contains":return[B.value]}return null}(c,u),h=function(V,j){let G=new Map;for(let B of rn(j))for(let ot of $s(V,B.fieldPath))switch(ot.op){case"==":case"in":G.set(B.fieldPath.canonicalString(),ot.value);break;case"not-in":case"!=":return G.set(B.fieldPath.canonicalString(),ot.value),Array.from(G.values())}return null}(c,u),d=function(V,j){let G=[],B=!0;for(let ot of rn(j)){let Jt=ot.kind===0?ff(V,ot.fieldPath,V.startAt):mf(V,ot.fieldPath,V.startAt);G.push(Jt.value),B&&(B=Jt.inclusive)}return new ce(G,B)}(c,u),m=function(V,j){let G=[],B=!0;for(let ot of rn(j)){let Jt=ot.kind===0?mf(V,ot.fieldPath,V.endAt):ff(V,ot.fieldPath,V.endAt);G.push(Jt.value),B&&(B=Jt.inclusive)}return new ce(G,B)}(c,u),S=this.ln(u,c,d),w=this.ln(u,c,m),v=this.hn(u,c,h),D=this.Pn(u.indexId,l,S,d.inclusive,w,m.inclusive,v);return f.forEach(D,M=>r.G(M,e.limit).next(V=>{V.forEach(j=>{let G=I.fromSegments(j.documentKey);o.has(G)||(o=o.add(G),a.push(G))})}))}).next(()=>a)}return f.resolve(null)})}un(t){let e=this.an.get(t);return e||(t.filters.length===0?e=[t]:e=P_($.create(t.filters,"and")).map(r=>Iu(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.an.set(t,e),e)}Pn(t,e,r,i,s,o,a){let u=(e!=null?e.length:1)*Math.max(r.length,s.length),c=u/(e!=null?e.length:1),l=[];for(let h=0;h<u;++h){let d=e?this.In(e[h/c]):xs,m=this.Tn(t,d,r[h%c],i),S=this.En(t,d,s[h%c],o),w=a.map(v=>this.Tn(t,d,v,!0));l.push(...this.createRange(m,S,w))}return l}Tn(t,e,r,i){let s=new un(t,I.empty(),e,r);return i?s:s.Ht()}En(t,e,r,i){let s=new un(t,I.empty(),e,r);return i?s.Ht():s}cn(t,e){let r=new to(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2,i=this.un(e);return f.forEach(i,s=>this.cn(t,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new Q(it.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&i.length>1&&r===2?1:r)}dn(t,e){let r=new an;for(let i of rn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);ye.St.ht(s,o)}return r.Ut()}In(t){let e=new an;return ye.St.ht(t,e.jt(0)),e.Ut()}An(t,e){let r=new an;return ye.St.ht(dn(this.databaseId,e),r.jt(function(s){let o=rn(s);return o.length===0?0:o[o.length-1].kind}(t))),r.Ut()}hn(t,e,r){if(r===null)return[];let i=[];i.push(new an);let s=0;for(let o of rn(t)){let a=r[s++];for(let u of i)if(this.Rn(e,o.fieldPath)&&_i(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);ye.St.ht(a,c)}}return this.mn(i)}ln(t,e,r){return this.hn(t,e,r.position)}mn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Ut();return e}Vn(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new an;u.seed(a.Ut()),ye.St.ht(o,u.jt(e.kind)),s.push(u)}return s}Rn(t,e){return!!t.filters.find(r=>r instanceof L&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=ri(t),i=jn(t);return(e?r.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.U()).next(s=>{let o=[];return f.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new fi(h.sequenceNumber,new Bt(yn(h.readTime),new I(re(h.documentKey)),h.largestBatchId)):fi.empty(),m=l.fields.map(([S,w])=>new Jn(it.fromServerFormat(S),w));return new tr(l.indexId,l.collectionGroup,m,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:k(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=ri(t),s=jn(t);return this.fn(t).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>f.forEach(a,u=>s.put(Rf(u.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return f.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),f.forEach(a,u=>this.gn(t,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?f.resolve():this.yn(t,s,u,c,l)}))))})}wn(t,e,r,i){return Bn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,e.key),documentKey:e.key.path.toArray()})}Sn(t,e,r,i){return Bn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,e.key),e.key.path.toArray()])}gn(t,e,r){let i=Bn(t),s=new Q(Pe);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,e)])},(o,a)=>{s=s.add(new un(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(t,e){let r=new Q(Pe),i=this.dn(e,t);if(i==null)return r;let s=iu(e);if(s!=null){let o=t.data.field(s.fieldPath);if(_i(o))for(let a of o.arrayValue.values||[])r=r.add(new un(e.indexId,t.key,this.In(a),i))}else r=r.add(new un(e.indexId,t.key,xs,i));return r}yn(t,e,r,i,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(u,c,l,h,d){let m=u.getIterator(),S=c.getIterator(),w=Un(m),v=Un(S);for(;w||v;){let D=!1,M=!1;if(w&&v){let V=l(w,v);V<0?M=!0:V>0&&(D=!0)}else w!=null?M=!0:D=!0;D?(h(v),v=Un(S)):M?(d(w),w=Un(m)):(w=Un(m),v=Un(S))}}(i,s,Pe,a=>{o.push(this.wn(t,e,r,a))},a=>{o.push(this.Sn(t,e,r,a))}),f.waitFor(o)}fn(t){let e=1;return jn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>Pe(o,a)).filter((o,a,u)=>!a||Pe(o,u[a-1])!==0);let i=[];i.push(t);for(let o of r){let a=Pe(o,t),u=Pe(o,e);if(a===0)i[0]=t.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,xs,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,xs,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(t,e){return Pe(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Ff)}getMinOffset(t,e){return f.mapArray(this.un(e),r=>this.cn(t,r).next(i=>i||R())).next(Ff)}};function kf(n){return yt(n,"collectionParents")}function Bn(n){return yt(n,"indexEntries")}function ri(n){return yt(n,"indexConfiguration")}function jn(n){return yt(n,"indexState")}function Ff(n){P(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Jc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Bt(t.readTime,t.documentKey,e)}var Mf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qt=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function rg(n,t,e){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),a=0,u=r.J({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(a===1)}));let c=[];for(let l of e.mutations){let h=cm(t,l.key.path,e.batchId);s.push(i.delete(h)),c.push(l.key)}return f.waitFor(s).next(()=>c)}function no(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw R();t=n.noDocument}return JSON.stringify(t).length}qt.DEFAULT_COLLECTION_PERCENTILE=10,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qt.DEFAULT=new qt(41943040,qt.DEFAULT_COLLECTION_PERCENTILE,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qt.DISABLED=new qt(-1,0,0);var ro=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(t,e,r,i){P(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).J({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=Wn(t),o=Ce(t);return o.add({}).next(a=>{P(typeof a=="number");let u=new vi(a,e,r,i),c=function(m,S,w){let v=w.baseMutations.map(M=>Si(m.ut,M)),D=w.mutations.map(M=>Si(m.ut,M));return{userId:S,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:v,mutations:D}}(this.serializer,this.userId,u),l=[],h=new Q((d,m)=>k(d.canonicalString(),m.canonicalString()));for(let d of i){let m=cm(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(m,My))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return Ce(t).get(e).next(r=>r?(P(r.userId===this.userId),on(this.serializer,r)):null)}Cn(t,e){return this.Dn[e]?f.resolve(this.Dn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Dn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Ce(t).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=on(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ce(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).U("userMutationsIndex",e).next(r=>r.map(i=>on(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Cs(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return Wn(t).J({range:i},(o,a,u)=>{let[c,l,h]=o,d=re(l);if(c===this.userId&&e.path.isEqual(d))return Ce(t).get(h).next(m=>{if(!m)throw R();P(m.userId===this.userId),s.push(on(this.serializer,m))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Q(k),i=[];return e.forEach(s=>{let o=Cs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Wn(t).J({range:a},(c,l,h)=>{let[d,m,S]=c,w=re(m);d===this.userId&&s.path.isEqual(w)?r=r.add(S):h.done()});i.push(u)}),f.waitFor(i).next(()=>this.vn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=Cs(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Q(k);return Wn(t).J({range:o},(u,c,l)=>{let[h,d,m]=u,S=re(d);h===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(m)):l.done()}).next(()=>this.vn(t,a))}vn(t,e){let r=[],i=[];return e.forEach(s=>{i.push(Ce(t).get(s).next(o=>{if(o===null)throw R();P(o.userId===this.userId),r.push(on(this.serializer,o))}))}),f.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return rg(t._e,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Fn(e.batchId)}),f.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Fn(t){delete this.Dn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return f.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Wn(t).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=re(s[1]);i.push(u)}else a.done()}).next(()=>{P(i.length===0)})})}containsKey(t,e){return ig(t,this.userId,e)}Mn(t){return sg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function ig(n,t,e){let r=Cs(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Wn(n).J({range:s,H:!0},(a,u,c)=>{let[l,h,d]=a;l===t&&h===i&&(o=!0),c.done()}).next(()=>o)}function Ce(n){return yt(n,"mutations")}function Wn(n){return yt(n,"documentMutations")}function sg(n){return yt(n,"mutationQueues")}var ar=class n{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var ju=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Ln(t).next(e=>{let r=new ar(e.highestTargetId);return e.highestTargetId=r.next(),this.Bn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Ln(t).next(e=>C.fromTimestamp(new X(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Ln(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Ln(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Bn(t,i)))}addTargetData(t,e){return this.kn(t,e).next(()=>this.Ln(t).next(r=>(r.targetCount+=1,this.qn(e,r),this.Bn(t,r))))}updateTargetData(t,e){return this.kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Gn(t).delete(e.targetId)).next(()=>this.Ln(t)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.Bn(t,r)))}removeTargets(t,e,r){let i=0,s=[];return Gn(t).J((o,a)=>{let u=ai(a);u.sequenceNumber<=e&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(t,u)))}).next(()=>f.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Gn(t).J((r,i)=>{let s=ai(i);e(s)})}Ln(t){return Lf(t).get("targetGlobalKey").next(e=>(P(e!==null),e))}Bn(t,e){return Lf(t).put("targetGlobalKey",e)}kn(t,e){return Gn(t).put(tg(this.serializer,e))}qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Ln(t).next(e=>e.targetCount)}getTargetData(t,e){let r=mn(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Gn(t).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=ai(a);Mi(e,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=De(t);return e.forEach(o=>{let a=xt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(t,r,o))}),f.waitFor(i)}removeMatchingKeys(t,e,r){let i=De(t);return f.forEach(e,s=>{let o=xt(s.path);return f.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=De(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=De(t),s=F();return i.J({range:r,H:!0},(o,a,u)=>{let c=re(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(t,e){let r=xt(e.path),i=IDBKeyRange.bound([r],[rm(r)],!1,!0),s=0;return De(t).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(t,e){return Gn(t).get(e).next(r=>r?ai(r):null)}};function Gn(n){return yt(n,"targets")}function Lf(n){return yt(n,"targetGlobal")}function De(n){return yt(n,"targetDocuments")}function Of([n,t],[e,r]){let i=k(n,e);return i===0?k(t,r):i}var Gu=class{constructor(t){this.Qn=t,this.buffer=new Q(Of),this.Kn=0}$n(){return++this.Kn}Un(t){let e=[t,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Of(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},zu=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(t){_("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>p(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){$e(e)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ke(e)}yield this.Gn(3e5)}))}},Ku=class{constructor(t,e){this.zn=t,this.params=e}calculateTargetCount(t,e){return this.zn.jn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return f.resolve(Nt.oe);let r=new Gu(e);return this.zn.forEachTarget(t,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(t,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.zn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(Mf)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Mf):this.Jn(t,e))}getCacheSize(t){return this.zn.getCacheSize(t)}Jn(t,e){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(t,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),zn()<=Zt.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function C_(n,t){return new Ku(n,t)}var $u=class{constructor(t,e){this.db=t,this.garbageCollector=C_(this,e)}jn(t){let e=this.Yn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}Yn(t){let e=0;return this.Hn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Hn(t,e){return this.Zn(t,(r,i)=>e(i))}addReference(t,e,r){return bs(t,r)}removeReference(t,e,r){return bs(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return bs(t,e)}Xn(t,e){return function(i,s){let o=!1;return sg(i).Y(a=>ig(i,a,s).next(u=>(u&&(o=!0),f.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(t,(o,a)=>{if(a<=e){let u=this.Xn(t,o).next(c=>{if(!c)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,C.min()),De(t).delete(function(h){return[0,xt(h.path)]}(o))))});i.push(u)}}).next(()=>f.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return bs(t,e)}Zn(t,e){let r=De(t),i,s=Nt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Nt.oe&&e(new I(re(i)),s),s=c,i=u):s=Nt.oe}).next(()=>{s!==Nt.oe&&e(new I(re(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function bs(n,t){return De(n).put(function(r,i){return{targetId:0,path:xt(r.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}var io=class{constructor(){this.changes=new le(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,dt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?f.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Qu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return nn(t).put(r)}removeEntry(t,e,r){return nn(t).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Xs(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.er(t,r)))}getEntry(t,e){let r=dt.newInvalidDocument(e);return nn(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(ii(e))},(i,s)=>{r=this.tr(e,s)}).next(()=>r)}nr(t,e){let r={size:0,document:dt.newInvalidDocument(e)};return nn(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(ii(e))},(i,s)=>{r={document:this.tr(e,s),size:no(s)}}).next(()=>r)}getEntries(t,e){let r=Ct();return this.rr(t,e,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(t,e){let r=Ct(),i=new J(I.comparator);return this.rr(t,e,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,no(o))}).next(()=>({documents:r,sr:i}))}rr(t,e,r){if(e.isEmpty())return f.resolve();let i=new Q(Bf);e.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ii(i.first()),ii(i.last())),o=i.getIterator(),a=o.getNext();return nn(t).J({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Bf(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(ii(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),Xs(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(t).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Ct();for(let h of c){let d=this.tr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Oi(e,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,i){let s=Ct(),o=Uf(e,r),a=Uf(e,Bt.max());return nn(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(t){return new Wu(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return qf(t).get("remoteDocumentGlobalKey").next(e=>(P(!!e),e))}er(t,e){return qf(t).put("remoteDocumentGlobalKey",e)}tr(t,e){if(e){let r=b_(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(C.min())))return r}return dt.newInvalidDocument(t)}};function og(n){return new Qu(n)}var Wu=class extends io{constructor(t,e){super(),this._r=t,this.trackRemovals=e,this.ar=new le(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new Q((s,o)=>k(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(e.push(this._r.removeEntry(t,s,a.readTime)),o.isValidDocument()){let u=xf(this._r.serializer,o);i=i.add(s.path.popLast());let c=no(u);r+=c-a.size,e.push(this._r.addEntry(t,s,u))}else if(r-=a.size,this.trackRemovals){let u=xf(this._r.serializer,o.convertToNoDocument(C.min()));e.push(this._r.addEntry(t,s,u))}}),i.forEach(s=>{e.push(this._r.indexManager.addToCollectionParentIndex(t,s))}),e.push(this._r.updateMetadata(t,r)),f.waitFor(e)}getFromCache(t,e){return this._r.nr(t,e).next(r=>(this.ar.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this._r.ir(t,e).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function qf(n){return yt(n,"remoteDocumentGlobal")}function nn(n){return yt(n,"remoteDocumentsV14")}function ii(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Uf(n,t){let e=t.documentKey.path.toArray();return[n,Xs(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Bf(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=k(e[s],r[s]),i)return i;return i=k(e.length,r.length),i||(i=k(e[e.length-2],r[r.length-2]),i||k(e[e.length-1],r[r.length-1]))}var Hu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var so=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&li(r.mutation,i,kt.empty(),X.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,F()).next(()=>r))}getLocalViewOfDocuments(t,e,r=F()){let i=ie();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=oi();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=ie();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,F()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,i){let s=Ct(),o=ci(),a=function(){return ci()}();return e.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof Qt)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),li(l.mutation,c,l.mutation.getFieldMask(),X.now())):o.set(c.key,kt.empty())}),this.recalculateAndSaveOverlays(t,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new Hu(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let r=ci(),i=new J((o,a)=>o-a),s=F();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=e.get(u);if(c===null)return;let l=r.get(u)||kt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||F()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=Pm();l.forEach(d=>{if(!s.has(d)){let m=Lm(e.get(d),r.get(d));m!==null&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):tl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):f.resolve(ie()),a=-1,u=s;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?f.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,s)).next(()=>this.computeViews(t,u,c,F())).next(l=>({batchId:a,changes:Rm(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new I(e)).next(r=>{let i=oi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=oi();return this.indexManager.getCollectionParents(t,s).next(a=>f.forEach(a,u=>{let c=function(h,d){return new $t(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,u.child(s));return this.getDocumentsMatchingCollectionQuery(t,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,dt.newInvalidDocument(l)))});let a=oi();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&li(l.mutation,c,kt.empty(),X.now()),Oi(e,c)&&(a=a.insert(u,c))}),a})}};var Ju=class{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return f.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(i){return{id:i.id,version:i.version,createTime:st(i.createTime)}}(e)),f.resolve()}getNamedQuery(t,e){return f.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(i){return{name:i.name,query:rl(i.bundledQuery),readTime:st(i.readTime)}}(e)),f.resolve()}};var Yu=class{constructor(){this.overlays=new J(I.comparator),this.lr=new Map}getOverlay(t,e){return f.resolve(this.overlays.get(e))}getOverlays(t,e){let r=ie();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.lt(t,e,s)}),f.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),f.resolve()}getOverlaysForCollection(t,e,r){let i=ie(),s=e.length+1,o=new I(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return f.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new J((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=ie(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=ie(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return f.resolve(a)}lt(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ii(e,r));let s=this.lr.get(e);s===void 0&&(s=F(),this.lr.set(e,s)),this.lr.set(e,s.add(r.key))}};var bi=class{constructor(){this.hr=new Q(ct.Pr),this.Ir=new Q(ct.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){let r=new ct(t,e);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.dr(new ct(t,e))}Ar(t,e){t.forEach(r=>this.removeReference(r,e))}Rr(t){let e=new I(new q([])),r=new ct(e,t),i=new ct(e,t+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(t=>this.dr(t))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){let e=new I(new q([])),r=new ct(e,t),i=new ct(e,t+1),s=F();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new ct(t,0),r=this.hr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},ct=class{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return I.comparator(t.key,e.key)||k(t.gr,e.gr)}static Tr(t,e){return k(t.gr,e.gr)||I.comparator(t.key,e.key)}};var Xu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new Q(ct.Pr)}checkEmpty(t){return f.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new vi(s,e,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new ct(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(t,e){return f.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.Sr(r),s=i<0?0:i;return f.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(t){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new ct(e,0),i=new ct(e,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),f.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Q(k);return e.forEach(i=>{let s=new ct(i,0),o=new ct(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),f.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new ct(new I(s),0),a=new Q(k);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),f.resolve(this.br(a))}br(t){let e=[];return t.forEach(r=>{let i=this.wr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){P(this.Dr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return f.forEach(e.mutations,i=>{let s=new ct(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.yr=r})}Fn(t){}containsKey(t,e){let r=new ct(e,0),i=this.yr.firstAfterOrEqual(r);return f.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,f.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}wr(t){let e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Zu=class{constructor(t){this.Cr=t,this.docs=function(){return new J(I.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return f.resolve(r?r.document.mutableCopy():dt.newInvalidDocument(e))}getEntries(t,e){let r=Ct();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():dt.newInvalidDocument(i))}),f.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Ct(),o=e.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Jc(sm(l),r)<=0||(i.has(l.key)||Oi(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(t,e,r,i){R()}vr(t,e){return f.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new tc(this)}getSize(t){return f.resolve(this.size)}},tc=class extends io{constructor(t){super(),this._r=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this._r.addEntry(t,i)):this._r.removeEntry(r)}),f.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}};var ec=class{constructor(t){this.persistence=t,this.Fr=new le(e=>mn(e),Mi),this.lastRemoteSnapshotVersion=C.min(),this.highestTargetId=0,this.Mr=0,this.Or=new bi,this.targetCount=0,this.Nr=ar.On()}forEachTarget(t,e){return this.Fr.forEach((r,i)=>e(i)),f.resolve()}getLastRemoteSnapshotVersion(t){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return f.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Mr&&(this.Mr=e),f.resolve()}kn(t){this.Fr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Nr=new ar(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,f.resolve()}updateTargetData(t,e){return this.kn(e),f.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,f.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=e&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),f.waitFor(s).next(()=>i)}getTargetCount(t){return f.resolve(this.targetCount)}getTargetData(t,e){let r=this.Fr.get(e)||null;return f.resolve(r)}addMatchingKeys(t,e,r){return this.Or.Er(e,r),f.resolve()}removeMatchingKeys(t,e,r){this.Or.Ar(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),f.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),f.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Or.mr(e);return f.resolve(r)}containsKey(t,e){return f.resolve(this.Or.containsKey(e))}};var oo=class{constructor(t,e){this.Lr={},this.overlays={},this.Br=new Nt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new ec(this),this.indexManager=new Uu,this.remoteDocumentCache=function(i){return new Zu(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new Ys(e),this.Kr=new Ju(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Yu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Lr[t.toKey()];return r||(r=new Xu(e,this.referenceDelegate),this.Lr[t.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,r){_("MemoryPersistence","Starting transaction:",t);let i=new nc(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(t,e){return f.or(Object.values(this.Lr).map(r=>()=>r.containsKey(t,e)))}},nc=class extends qs{constructor(t){super(),this.currentSequenceNumber=t}},ao=class n{constructor(t){this.persistence=t,this.Gr=new bi,this.zr=null}static jr(t){return new n(t)}get Hr(){if(this.zr)return this.zr;throw R()}addReference(t,e,r){return this.Gr.addReference(r,e),this.Hr.delete(r.toString()),f.resolve()}removeReference(t,e,r){return this.Gr.removeReference(r,e),this.Hr.add(r.toString()),f.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),f.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}$r(){this.zr=new Set}Ur(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Hr,r=>{let i=I.fromPath(r);return this.Jr(t,i).next(s=>{s||e.removeEntry(i,C.min())})}).next(()=>(this.zr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Jr(t,e).next(r=>{r?this.Hr.delete(e.toString()):this.Hr.add(e.toString())})}Qr(t){return 0}Jr(t,e){return f.or([()=>f.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}};var rc=class{constructor(t){this.serializer=t}O(t,e,r,i){let s=new Us("createOrUpgrade",e);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(t),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rf,{unique:!0}),u.createObjectStore("documentMutations")}(t),jf(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=f.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),jf(t)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:C.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rf,{unique:!0});let h=c.store("mutations"),d=l.map(m=>h.put(m));return f.waitFor(d)})}(t,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:Wy});c.createIndex("collectionPathOverlayIndex",Hy,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Jy,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:Ly});c.createIndex("documentKeyIndex",Oy),c.createIndex("collectionGroupIndex",qy)}(t)).next(()=>this.ri(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(t,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:zy}).createIndex("sequenceNumberIndex",Ky,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:$y}).createIndex("documentKeyIndex",Qy,{unique:!1})}(t))),r<16&&i>=16&&(o=o.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),o}Xr(t){let e=0;return t.store("remoteDocuments").J((r,i)=>{e+=no(i)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.U().next(i=>f.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>f.forEach(a,u=>{P(u.userId===s.userId);let c=on(this.serializer,u);return rg(t,s.userId,c).next(()=>{})}))}))}ei(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new q(o),c=function(h){return[0,xt(h)]}(u);s.push(e.get(c).next(l=>l?f.resolve():(h=>e.put({targetId:0,path:xt(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>f.waitFor(s))})}ti(t,e){t.createObjectStore("collectionParents",{keyPath:Gy});let r=e.store("collectionParents"),i=new xi,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:xt(u)})}};return e.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new q(o);return s(u.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([o,a,u],c)=>{let l=re(a);return s(l.popLast())}))}ni(t){let e=t.store("targets");return e.J((r,i)=>{let s=ai(i),o=tg(this.serializer,s);return e.put(o)})}ri(t,e){let r=e.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=e.store("remoteDocumentsV14"),u=function(h){return h.document?new I(q.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):R()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>f.waitFor(i))}ii(t,e){let r=e.store("mutations"),i=og(this.serializer),s=new oo(ao.jr,this.serializer.ut);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:F();on(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{let l=new lt(c),h=Zs.ct(this.serializer,l),d=s.getIndexManager(l),m=ro.ct(l,this.serializer,d,s.referenceDelegate);return new so(i,m,h,d).recalculateAndSaveOverlaysForDocumentKeys(new gi(e,Nt.oe),u).next()})})}};function jf(n){n.createObjectStore("targetDocuments",{keyPath:By}).createIndex("documentTargetsIndex",jy,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Uy,{unique:!0}),n.createObjectStore("targetGlobal")}var Wa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ic=class n{constructor(t,e,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $u(this,i),this.Ii=e+"main",this.serializer=new Ys(u),this.Ti=new Me(this.Ii,this.ai,new rc(this.serializer)),this.qr=new ju(this.referenceDelegate,this.serializer),this.remoteDocumentCache=og(this.serializer),this.Kr=new Nu,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&rt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Wa);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.qr.getHighestSequenceNumber(t))}).then(t=>{this.Br=new Nt(t,this.oi)}).then(()=>{this.kr=!0}).catch(t=>(this.Ti&&this.Ti.close(),Promise.reject(t)))}mi(t){return this.Pi=e=>p(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ti.L(e=>p(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.si.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Rs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(t)).next(e=>this.isPrimary&&!e?this.pi(t).next(()=>!1):!!e&&this.yi(t).next(()=>!0))).catch(t=>{if($e(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.si.enqueueRetryable(()=>this.Pi(t)),this.isPrimary=t})}fi(t){return si(t).get("owner").next(e=>f.resolve(this.wi(e)))}Si(t){return Rs(t).delete(this.clientId)}bi(){return p(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=yt(e,"clientMetadata");return r.U().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return f.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let e of t)this.Ei.removeItem(this.vi(e.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(t){return!!t&&t.ownerId===this.clientId}gi(t){return this._i?f.resolve(!0):si(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)){if(this.wi(e)&&this.networkEnabled)return!0;if(!this.wi(e)){if(!e.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Wa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rs(t).U().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return p(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new gi(t,Nt.oe);return this.pi(e).next(()=>this.Si(e))}),this.Ti.close(),this.Ni()})}Ci(t,e){return t.filter(r=>this.Di(r.updateTimeMs,e)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",t=>Rs(t).U().next(e=>this.Ci(e,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(t,e){return ro.ct(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Bu(t,this.serializer.ut.databaseId)}getDocumentOverlayCache(t){return Zs.ct(this.serializer,t)}getBundleCache(){return this.Kr}runTransaction(t,e,r){_("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(u){return u===16?Xy:u===15?fm:u===14?dm:u===13?hm:u===12?Yy:u===11?lm:void R()}(this.ai),o;return this.Ti.runTransaction(t,i,s,a=>(o=new gi(a,this.Br?this.Br.next():Nt.oe),e==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw rt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(g.FAILED_PRECONDITION,om);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(t){return si(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)&&!this.wi(e)&&!(this._i||this.allowTabSynchronization&&e.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,Wa)})}yi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return si(t).put("owner",e)}static D(){return Me.D()}pi(t){let e=si(t);return e.get("owner").next(r=>this.wi(r)?(_("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):f.resolve())}Di(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(rt(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let e=/(?:Version|Mobile)\/1[456]/;Zo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(t){var e;try{let r=((e=this.Ei)===null||e===void 0?void 0:e.getItem(this.vi(t)))!==null;return _("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return rt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(t){rt("Failed to set zombie client id.",t)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function si(n){return yt(n,"owner")}function Rs(n){return yt(n,"clientMetadata")}function sl(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var sc=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.ki=r,this.qi=i}static Qi(t,e){let r=F(),i=F();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var oc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var uo=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return Zo()?8:am(Vr())>0?6:4}()}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.zi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new oc;return this.Hi(t,e,o).next(a=>{if(s.result=a,this.$i)return this.Ji(t,e,o,a.size)})}).next(()=>s.result)}Ji(t,e,r,i){return r.documentReadCount<this.Ui?(zn()<=Zt.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",Kn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),f.resolve()):(zn()<=Zt.DEBUG&&_("QueryEngine","Query:",Kn(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(zn()<=Zt.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",Kn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,bt(e))):f.resolve())}zi(t,e){if(gf(e))return f.resolve(null);let r=bt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Qs(e,null,"F"),r=bt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=F(...s);return this.Gi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Yi(e,a);return this.Zi(e,c,o,u.readTime)?this.zi(t,Qs(e,null,"F")):this.Xi(t,c,e,u)}))})))}ji(t,e,r,i){return gf(e)||i.isEqual(C.min())?f.resolve(null):this.Gi.getDocuments(t,r).next(s=>{let o=this.Yi(e,s);return this.Zi(e,o,r,i)?f.resolve(null):(zn()<=Zt.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Kn(e)),this.Xi(t,o,e,im(i,-1)).next(a=>a))})}Yi(t,e){let r=new Q(xm(t));return e.forEach((i,s)=>{Oi(t,s)&&(r=r.add(s))}),r}Zi(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(t,e,r){return zn()<=Zt.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Kn(e)),this.Gi.getDocumentsMatchingQuery(t,e,Bt.min(),r)}Xi(t,e,r,i){return this.Gi.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var ac=class{constructor(t,e,r,i){this.persistence=t,this.es=e,this.serializer=i,this.ts=new J(k),this.ns=new le(s=>mn(s),Mi),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(r)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new so(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ts))}};function ag(n,t,e,r){return new ac(n,t,e,r)}function ug(n,t){return p(this,null,function*(){let e=T(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e.os(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=F();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function D_(n,t){let e=T(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),m=f.resolve();return d.forEach(S=>{m=m.next(()=>l.getEntry(u,S)).next(w=>{let v=c.docVersions.get(S);P(v!==null),w.version.compareTo(v)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=F();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function cg(n){let t=T(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.qr.getLastRemoteSnapshotVersion(e))}function V_(n,t){let e=T(n),r=t.snapshotVersion,i=e.ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.ss.newChangeBuffer({trackRemovals:!0});i=e.ts;let a=[];t.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(e.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?m=m.withResumeToken(pt.EMPTY_BYTE_STRING,C.min()).withLastLimboFreeSnapshotVersion(C.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),function(w,v,D){return w.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(d,m,l)&&a.push(e.qr.updateTargetData(s,m))});let u=Ct(),c=F();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(lg(s,o,t.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(C.min())){let l=e.qr.getLastRemoteSnapshotVersion(s).next(h=>e.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(e.ts=i,s))}function lg(n,t,e){let r=F(),i=F();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Ct();return e.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(C.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function N_(n,t){let e=T(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function ur(n,t){let e=T(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.qr.getTargetData(r,t).next(s=>s?(i=s,f.resolve(i)):e.qr.allocateTargetId(r).next(o=>(i=new or(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ts=e.ts.insert(r.targetId,r),e.ns.set(t,r.targetId)),r})}function cr(n,t,e){return p(this,null,function*(){let r=T(n),i=r.ts.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!$e(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ts=r.ts.remove(t),r.ns.delete(i.target)})}function co(n,t,e){let r=T(n),i=C.min(),s=F();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=T(u),d=h.ns.get(l);return d!==void 0?f.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,bt(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,t,e?i:C.min(),e?s:F())).next(a=>(fg(r,Sm(t),a),{documents:a,ls:s})))}function hg(n,t){let e=T(n),r=T(e.qr),i=e.ts.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,t).next(o=>o?o.target:null))}function dg(n,t){let e=T(n),r=e.rs.get(t)||C.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.ss.getAllFromCollectionGroup(i,t,im(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(fg(e,t,i),i))}function fg(n,t,e){let r=n.rs.get(t)||C.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(t,r)}function k_(n,t,e,r){return p(this,null,function*(){let i=T(n),s=F(),o=Ct();for(let c of e){let l=t.hs(c.metadata.name);c.document&&(s=s.add(l));let h=t.Ps(c);h.setReadTime(t.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield ur(i,function(l){return bt(yr(q.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>lg(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function F_(r,i){return p(this,arguments,function*(n,t,e=F()){let s=yield ur(n,bt(rl(t.bundledQuery))),o=T(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=st(t.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,t);let c=s.withResumeToken(pt.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,e,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,t))})})}function Gf(n,t){return`firestore_clients_${n}_${t}`}function zf(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Ha(n,t){return`firestore_targets_${n}_${t}`}var lo=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Ts(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(rt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},hi=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Ts(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(t,r.state,i):(rt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ho=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ts(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=el();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=um(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(rt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},uc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Ts(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(rt("SharedClientState",`Failed to parse online state: ${t}`),null)}},Ri=class{constructor(){this.activeTargetIds=el()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},di=class{constructor(t,e,r,i,s){this.window=t,this.si=e,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new J(k),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Gf(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Ri),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(t){return!(!t||!t.localStorage)}start(){return p(this,null,function*(){let t=yield this.syncEngine.Li();for(let r of t){if(r===this.Rs)continue;let i=this.getItem(Gf(this.persistenceKey,r));if(i){let s=ho.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let e=this.storage.getItem(this.Cs);if(e){let r=this.Ms(e);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(t){let e=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ns(t,"pending")}updateMutationState(t,e,r){this.Ns(t,e,r),this.Ls(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem(Ha(this.persistenceKey,t));if(r){let i=hi.Ts(t,r);i&&(e=i.state)}}return this.Bs.ds(t),this.Fs(),e}removeLocalQueryTarget(t){this.Bs.As(t),this.Fs()}isLocalQueryTarget(t){return this.Bs.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ha(this.persistenceKey,t))}updateQueryState(t,e,r){this.ks(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Ls(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.qs(t)}notifyBundleLoaded(t){this.Qs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return _("SharedClientState","READ",t,e),e}setItem(t,e){_("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_("SharedClientState","REMOVE",t),this.storage.removeItem(t)}fs(t){let e=t;if(e.storageArea===this.storage){if(_("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ys)return void rt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(e.key!==null){if(this.Ss.test(e.key)){if(e.newValue==null){let r=this.Ks(e.key);return this.$s(r,null)}{let r=this.Us(e.key,e.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(e.key)){if(e.newValue!==null){let r=this.Ws(e.key,e.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let r=this.zs(e.key,e.newValue);if(r)return this.js(r)}}else if(e.key===this.Cs){if(e.newValue!==null){let r=this.Ms(e.newValue);if(r)return this.xs(r)}}else if(e.key===this.ws){let r=function(s){let o=Nt.oe;if(s!=null)try{let a=JSON.parse(s);P(typeof a=="number"),o=a}catch(a){rt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);r!==Nt.oe&&this.sequenceNumberHandler(r)}else if(e.key===this.vs){let r=this.Hs(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(e)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(t,e,r){let i=new lo(this.currentUser,t,e,r),s=zf(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Es())}Ls(t){let e=zf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}qs(t){let e={clientId:this.Rs,onlineState:t};this.storage.setItem(this.Cs,JSON.stringify(e))}ks(t,e,r){let i=Ha(this.persistenceKey,t),s=new hi(t,e,r);this.setItem(i,s.Es())}Qs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.vs,e)}Ks(t){let e=this.Ss.exec(t);return e?e[1]:null}Us(t,e){let r=this.Ks(t);return ho.Ts(r,e)}Ws(t,e){let r=this.bs.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return lo.Ts(new lt(s),i,e)}zs(t,e){let r=this.Ds.exec(t),i=Number(r[1]);return hi.Ts(i,e)}Ms(t){return uc.Ts(t)}Hs(t){return JSON.parse(t)}Gs(t){return p(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Ys(t.batchId,t.state,t.error);_("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}js(t){return this.syncEngine.Zs(t.targetId,t.state,t.error)}$s(t,e){let r=e?this.gs.insert(t,e):this.gs.remove(t),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(t){this.gs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Os(t){let e=el();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},fo=class{constructor(){this.eo=new Ri,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,r){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new Ri,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var cc=class{ro(t){}shutdown(){}};var mo=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ao)t(0)}_o(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ao)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ps=null;function Ja(){return Ps===null?Ps=function(){return 268435456+Math.round(2147483648*Math.random())}():Ps++,"0x"+Ps.toString(16)}var M_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var lc=class{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}Eo(t){this.Ao=t}onMessage(t){this.Ro=t}close(){this.lo()}send(t){this.co(t)}Vo(){this.Po()}mo(){this.To()}fo(t){this.Ao(t)}po(t){this.Ro(t)}};var Tt="WebChannelConnection",hc=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+e.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(e,r,i,s,o){let a=Ja(),u=this.Co(e,r.toUriEncodedString());_("RestConnection",`Sending RPC '${e}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(e,u,c,i).then(l=>(_("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw Ut("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(e,r,i,s,o,a){return this.Do(e,r,i,s,o)}vo(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+pr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}Co(e,r){let i=M_[e];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Fo(t,e,r,i){let s=Ja();return new Promise((o,a)=>{let u=new Xd;u.setWithCredentials(!0),u.listenOnce(Hd.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ss.NO_ERROR:let l=u.getResponseJson();_(Tt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Ss.TIMEOUT:_(Tt,`RPC '${t}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case Ss.HTTP_ERROR:let h=u.getStatus();if(_(Tt,`RPC '${t}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let m=d?.error;if(m&&m.status&&m.message){let S=function(v){let D=v.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(D)>=0?D:g.UNKNOWN}(m.status);a(new y(S,m.message))}else a(new y(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{_(Tt,`RPC '${t}' ${s} completed.`)}});let c=JSON.stringify(i);_(Tt,`RPC '${t}' ${s} sending request:`,i),u.send(e,"POST",c,r,15)})}xo(t,e,r){let i=Ja(),s=[this.yo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Qd(),a=Wd(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new Yd({})),this.vo(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let l=s.join("");_(Tt,`Creating RPC '${t}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,m=!1,S=new lc({co:v=>{m?_(Tt,`Not sending because RPC '${t}' stream ${i} is closed:`,v):(d||(_(Tt,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),_(Tt,`RPC '${t}' stream ${i} sending:`,v),h.send(v))},lo:()=>h.close()}),w=(v,D,M)=>{v.listen(D,V=>{try{M(V)}catch(j){setTimeout(()=>{throw j},0)}})};return w(h,ei.EventType.OPEN,()=>{m||(_(Tt,`RPC '${t}' stream ${i} transport opened.`),S.Vo())}),w(h,ei.EventType.CLOSE,()=>{m||(m=!0,_(Tt,`RPC '${t}' stream ${i} transport closed`),S.fo())}),w(h,ei.EventType.ERROR,v=>{m||(m=!0,Ut(Tt,`RPC '${t}' stream ${i} transport errored:`,v),S.fo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,ei.EventType.MESSAGE,v=>{var D;if(!m){let M=v.data[0];P(!!M);let V=M,j=V.error||((D=V[0])===null||D===void 0?void 0:D.error);if(j){_(Tt,`RPC '${t}' stream ${i} received error:`,j);let G=j.status,B=function(Fp){let zl=ut[Fp];if(zl!==void 0)return Um(zl)}(G),ot=j.message;B===void 0&&(B=g.INTERNAL,ot="Unknown error status: "+G+" with message "+j.message),m=!0,S.fo(new y(B,ot)),h.close()}else _(Tt,`RPC '${t}' stream ${i} received:`,M),S.po(M)}}),w(a,Jd.STAT_EVENT,v=>{v.stat===$a.PROXY?_(Tt,`RPC '${t}' stream ${i} detected buffering proxy`):v.stat===$a.NOPROXY&&_(Tt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.mo()},0),S}};function mg(){return typeof window<"u"?window:null}function ks(){return typeof document<"u"?document:null}function qi(n){return new Ru(n,!0)}var Pi=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.si=t,this.timerId=e,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();let e=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,e-r);i>0&&_("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),t())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var go=class{constructor(t,e,r,i,s,o,a,u){this.si=t,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Pi(t,e)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return p(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(t){this.i_(),this.stream.send(t)}n_(){return p(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(t,e){return p(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,t!==4?this.Jo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(rt(e.toString()),rt("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Eo(e)})}o_(){}auth(){this.state=1;let t=this.__(this.zo),e=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===e&&this.a_(r,i)},r=>{t(()=>{let i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(t,e){let r=this.__(this.zo);this.stream=this.c_(t,e),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>p(this,null,function*(){this.state=0,this.start()}))}u_(t){return _("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}__(t){return e=>{this.si.enqueueAndForget(()=>this.zo===t?e():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},dc=class extends go{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}c_(t,e){return this.connection.xo("Listen",t,e)}onMessage(t){this.Jo.reset();let e=v_(this.serializer,t),r=function(s){if(!("targetChange"in s))return C.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?C.min():o.readTime?st(o.readTime):C.min()}(t);return this.listener.l_(e,r)}h_(t){let e={};e.database=Du(this.serializer),e.addTarget=function(s,o){let a,u=o.target;if(a=Ks(u)?{documents:Wm(s,u)}:{query:Hm(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=jm(s,o.resumeToken);let c=Pu(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(C.min())>0){a.readTime=sr(s,o.snapshotVersion.toTimestamp());let c=Pu(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=E_(this.serializer,t);r&&(e.labels=r),this.r_(e)}P_(t){let e={};e.database=Du(this.serializer),e.removeTarget=t,this.r_(e)}},fc=class extends go{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(t,e){return this.connection.xo("Write",t,e)}onMessage(t){if(P(!!t.streamToken),this.lastStreamToken=t.streamToken,this.I_){this.Jo.reset();let e=I_(t.writeResults,t.commitTime),r=st(t.commitTime);return this.listener.d_(r,e)}return P(!t.writeResults||t.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let t={};t.database=Du(this.serializer),this.r_(t)}E_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Si(this.serializer,r))};this.r_(e)}};var mc=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}Do(t,e,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(t,Cu(e,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}Mo(t,e,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(t,Cu(e,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var gc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(t){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,t==="Online"&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(rt(e),this.y_=!1):_("OnlineStateTracker",e)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var pc=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>p(this,null,function*(){Qe(this)&&(_("RemoteStore","Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let c=T(u);c.M_.add(4),yield _r(c),c.N_.set("Unknown"),c.M_.delete(4),yield Ui(c)})}(this))}))}),this.N_=new gc(r,i)}};function Ui(n){return p(this,null,function*(){if(Qe(n))for(let t of n.x_)yield t(!0)})}function _r(n){return p(this,null,function*(){for(let t of n.x_)yield t(!1)})}function ko(n,t){let e=T(n);e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),ul(e)?al(e):vr(e).Zo()&&ol(e,t))}function lr(n,t){let e=T(n),r=vr(e);e.F_.delete(t),r.Zo()&&gg(e,t),e.F_.size===0&&(r.Zo()?r.t_():Qe(e)&&e.N_.set("Unknown"))}function ol(n,t){if(n.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(C.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}vr(n).h_(t)}function gg(n,t){n.L_.xe(t),vr(n).P_(t)}function al(n){n.L_=new bu({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>n.F_.get(t)||null,tt:()=>n.datastore.serializer.databaseId}),vr(n).start(),n.N_.w_()}function ul(n){return Qe(n)&&!vr(n).Yo()&&n.F_.size>0}function Qe(n){return T(n).M_.size===0}function pg(n){n.L_=void 0}function L_(n){return p(this,null,function*(){n.N_.set("Online")})}function O_(n){return p(this,null,function*(){n.F_.forEach((t,e)=>{ol(n,t)})})}function q_(n,t){return p(this,null,function*(){pg(n),ul(n)?(n.N_.D_(t),al(n)):n.N_.set("Unknown")})}function U_(n,t,e){return p(this,null,function*(){if(n.N_.set("Online"),t instanceof Hs&&t.state===2&&t.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,t)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield po(n,r)}else if(t instanceof Xn?n.L_.Ke(t):t instanceof Ws?n.L_.He(t):n.L_.We(t),!e.isEqual(C.min()))try{let r=yield cg(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(pt.EMPTY_BYTE_STRING,l.snapshotVersion)),gg(s,u);let h=new or(l.target,u,c,l.sequenceNumber);ol(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield po(n,r)}})}function po(n,t,e){return p(this,null,function*(){if(!$e(t))throw t;n.M_.add(1),yield _r(n),n.N_.set("Offline"),e||(e=()=>cg(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){_("RemoteStore","Retrying IndexedDB access"),yield e(),n.M_.delete(1),yield Ui(n)}))})}function yg(n,t){return t().catch(e=>po(n,e,t))}function wr(n){return p(this,null,function*(){let t=T(n),e=ze(t),r=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;B_(t);)try{let i=yield N_(t.localStore,r);if(i===null){t.v_.length===0&&e.t_();break}r=i.batchId,j_(t,i)}catch(i){yield po(t,i)}_g(t)&&wg(t)})}function B_(n){return Qe(n)&&n.v_.length<10}function j_(n,t){n.v_.push(t);let e=ze(n);e.Zo()&&e.T_&&e.E_(t.mutations)}function _g(n){return Qe(n)&&!ze(n).Yo()&&n.v_.length>0}function wg(n){ze(n).start()}function G_(n){return p(this,null,function*(){ze(n).R_()})}function z_(n){return p(this,null,function*(){let t=ze(n);for(let e of n.v_)t.E_(e.mutations)})}function K_(n,t,e){return p(this,null,function*(){let r=n.v_.shift(),i=Au.from(r,t,e);yield yg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield wr(n)})}function $_(n,t){return p(this,null,function*(){t&&ze(n).T_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return qm(o)&&o!==g.ABORTED}(i.code)){let s=r.v_.shift();ze(r).e_(),yield yg(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield wr(r)}})}(n,t)),_g(n)&&wg(n)})}function Kf(n,t){return p(this,null,function*(){let e=T(n);e.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");let r=Qe(e);e.M_.add(3),yield _r(e),r&&e.N_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.M_.delete(3),yield Ui(e)})}function yc(n,t){return p(this,null,function*(){let e=T(n);t?(e.M_.delete(2),yield Ui(e)):t||(e.M_.add(2),yield _r(e),e.N_.set("Unknown"))})}function vr(n){return n.B_||(n.B_=function(e,r,i){let s=T(e);return s.m_(),new dc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:L_.bind(null,n),Io:O_.bind(null,n),Eo:q_.bind(null,n),l_:U_.bind(null,n)}),n.x_.push(t=>p(this,null,function*(){t?(n.B_.e_(),ul(n)?al(n):n.N_.set("Unknown")):(yield n.B_.stop(),pg(n))}))),n.B_}function ze(n){return n.k_||(n.k_=function(e,r,i){let s=T(e);return s.m_(),new fc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:G_.bind(null,n),Eo:$_.bind(null,n),A_:z_.bind(null,n),d_:K_.bind(null,n)}),n.x_.push(t=>p(this,null,function*(){t?(n.k_.e_(),yield wr(n)):(yield n.k_.stop(),n.v_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var _c=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,a=new n(t,e,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ir(n,t){if(rt("AsyncQueue",`${t}: ${n}`),$e(n))return new y(g.UNAVAILABLE,`${t}: ${n}`);throw n}var yo=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||I.comparator(e.key,r.key):(e,r)=>I.comparator(e.key,r.key),this.keyedMap=oi(),this.sortedSet=new J(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var _o=class{constructor(){this.q_=new J(I.comparator)}track(t){let e=t.doc.key,r=this.q_.get(e);r?t.type!==0&&r.type===3?this.q_=this.q_.insert(e,t):t.type===3&&r.type!==1?this.q_=this.q_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.q_=this.q_.remove(e):t.type===1&&r.type===2?this.q_=this.q_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):R():this.q_=this.q_.insert(e,t)}Q_(){let t=[];return this.q_.inorderTraversal((e,r)=>{t.push(r)}),t}},hr=class n{constructor(t,e,r,i,s,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,yo.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Li(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var wc=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(t=>t.G_())}},vc=class{constructor(){this.queries=new le(t=>Am(t),Li),this.onlineState="Unknown",this.z_=new Set}};function cl(n,t){return p(this,null,function*(){let e=T(n),r=3,i=t.query,s=e.queries.get(i);s?!s.W_()&&t.G_()&&(r=2):(s=new wc,r=t.G_()?0:1);try{switch(r){case 0:s.K_=yield e.onListen(i,!0);break;case 1:s.K_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(o){let a=Ir(o,`Initialization of query '${Kn(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,s),s.U_.push(t),t.j_(e.onlineState),s.K_&&t.H_(s.K_)&&hl(e)})}function ll(n,t){return p(this,null,function*(){let e=T(n),r=t.query,i=3,s=e.queries.get(r);if(s){let o=s.U_.indexOf(t);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=t.G_()?0:1:!s.W_()&&t.G_()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function Q_(n,t){let e=T(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&hl(e)}function W_(n,t,e){let r=T(n),i=r.queries.get(t);if(i)for(let s of i.U_)s.onError(e);r.queries.delete(t)}function hl(n){n.z_.forEach(t=>{t.next()})}var Ic,$f;($f=Ic||(Ic={})).J_="default",$f.Cache="cache";var Ci=class{constructor(t,e,r){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new hr(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache||!this.G_())return!0;let r=e!=="Offline";return(!this.options.ra||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ea(t){if(t.docChanges.length>0)return!0;let e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}na(t){t=hr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==Ic.Cache}};var Ec=class{constructor(t,e){this.ia=t,this.byteLength=e}sa(){return"metadata"in this.ia}};var wo=class{constructor(t){this.serializer=t}hs(t){return oe(this.serializer,t)}Ps(t){return t.metadata.exists?Qm(this.serializer,t.document,!1):dt.newNoDocument(this.hs(t.metadata.name),this.Is(t.metadata.readTime))}Is(t){return st(t)}},Tc=class{constructor(t,e,r){this.oa=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vg(t)}_a(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ia.namedQuery)this.queries.push(t.ia.namedQuery);else if(t.ia.documentMetadata){this.documents.push({metadata:t.ia.documentMetadata}),t.ia.documentMetadata.exists||++e;let r=q.fromString(t.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.ia.document&&(this.documents[this.documents.length-1].document=t.ia.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}aa(t){let e=new Map,r=new wo(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(e.get(o)||F()).add(s);e.set(o,a)}}return e}complete(){return p(this,null,function*(){let t=yield k_(this.localStore,new wo(this.serializer),this.documents,this.oa.id),e=this.aa(this.documents);for(let r of this.queries)yield F_(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:t}})}};function vg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var vo=class{constructor(t){this.key=t}},Io=class{constructor(t){this.key=t}},Eo=class{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=F(),this.mutatedKeys=F(),this.Ia=xm(t),this.Ta=new yo(this.Ia)}get Ea(){return this.la}da(t,e){let r=e?e.Aa:new _o,i=e?e.Ta:this.Ta,s=e?e.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{let d=i.get(l),m=Oi(this.query,h)?h:null,S=!!d&&this.mutatedKeys.has(d.key),w=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),v=!1;d&&m?d.data.isEqual(m.data)?S!==w&&(r.track({type:3,doc:m}),v=!0):this.Ra(d,m)||(r.track({type:2,doc:m}),v=!0,(u&&this.Ia(m,u)>0||c&&this.Ia(m,c)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),v=!0):d&&!m&&(r.track({type:1,doc:d}),v=!0,(u||c)&&(a=!0)),v&&(m?(o=o.add(m),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;let o=t.Aa.Q_();o.sort((l,h)=>function(m,S){let w=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return w(m)-w(S)}(l.type,h.type)||this.Ia(l.doc,h.doc)),this.Va(r),i=i!=null&&i;let a=e&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,o.length!==0||c?{snapshot:new hr(this.query,t.Ta,s,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new _o,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach(e=>this.la=this.la.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=t.current)}ma(){if(!this.current)return[];let t=this.Pa;this.Pa=F(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let e=[];return t.forEach(r=>{this.Pa.has(r)||e.push(new Io(r))}),this.Pa.forEach(r=>{t.has(r)||e.push(new vo(r))}),e}pa(t){this.la=t.ls,this.Pa=F();let e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return hr.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Ac=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Sc=class{constructor(t){this.key=t,this.wa=!1}},xc=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new le(a=>Am(a),Li),this.Da=new Map,this.Ca=new Set,this.va=new J(I.comparator),this.Fa=new Map,this.Ma=new bi,this.xa={},this.Oa=new Map,this.Na=ar.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function H_(n,t,e=!0){return p(this,null,function*(){let r=Fo(n),i,s=r.ba.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Ig(r,t,e,!0),i})}function J_(n,t){return p(this,null,function*(){let e=Fo(n);yield Ig(e,t,!0,!1)})}function Ig(n,t,e,r){return p(this,null,function*(){let i=yield ur(n.localStore,bt(t)),s=i.targetId,o=e?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield dl(n,t,s,o==="current",i.resumeToken)),n.isPrimaryClient&&e&&ko(n.remoteStore,i),a})}function dl(n,t,e,r,i){return p(this,null,function*(){n.Ba=(h,d,m)=>function(w,v,D,M){return p(this,null,function*(){let V=v.view.da(D);V.Zi&&(V=yield co(w.localStore,v.query,!1).then(({documents:ot})=>v.view.da(ot,V)));let j=M&&M.targetChanges.get(v.targetId),G=M&&M.targetMismatches.get(v.targetId)!=null,B=v.view.applyChanges(V,w.isPrimaryClient,j,G);return bc(w,v.targetId,B.fa),B.snapshot})}(n,h,d,m);let s=yield co(n.localStore,t,!0),o=new Eo(t,s.ls),a=o.da(s.documents),u=Ti.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);bc(n,e,c.fa);let l=new Ac(t,e,o);return n.ba.set(t,l),n.Da.has(e)?n.Da.get(e).push(t):n.Da.set(e,[t]),c.snapshot})}function Y_(n,t,e){return p(this,null,function*(){let r=T(n),i=r.ba.get(t),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Li(o,t))),void r.ba.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield cr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&lr(r.remoteStore,i.targetId),dr(r,i.targetId)}).catch(Ke))):(dr(r,i.targetId),yield cr(r.localStore,i.targetId,!0))})}function X_(n,t){return p(this,null,function*(){let e=T(n),r=e.ba.get(t),i=e.Da.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),lr(e.remoteStore,r.targetId))})}function Z_(n,t,e){return p(this,null,function*(){let r=pl(n);try{let i=yield function(o,a){let u=T(o),c=X.now(),l=a.reduce((m,S)=>m.add(S.key),F()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",m=>{let S=Ct(),w=F();return u.ss.getEntries(m,l).next(v=>{S=v,S.forEach((D,M)=>{M.isValidDocument()||(w=w.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(m,S)).next(v=>{h=v;let D=[];for(let M of a){let V=f_(M,h.get(M.key).overlayedDocument);V!=null&&D.push(new Qt(M.key,V,ym(V.value.mapValue),nt.exists(!0)))}return u.mutationQueue.addMutationBatch(m,c,D,a)}).next(v=>{d=v;let D=v.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(m,v.batchId,D)})}).then(()=>({batchId:d.batchId,changes:Rm(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new J(k)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,e),yield Ae(r,i.changes),yield wr(r.remoteStore)}catch(i){let s=Ir(i,"Failed to persist write");e.reject(s)}})}function Eg(n,t){return p(this,null,function*(){let e=T(n);try{let r=yield V_(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.Fa.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?P(o.wa):i.removedDocuments.size>0&&(P(o.wa),o.wa=!1))}),yield Ae(e,r,t)}catch(r){yield Ke(r)}})}function Qf(n,t,e){let r=T(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=T(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.U_)d.j_(a)&&(c=!0)}),c&&hl(u)}(r.eventManager,t),i.length&&r.Sa.l_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function tw(n,t,e){return p(this,null,function*(){let r=T(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.Fa.get(t),s=i&&i.key;if(s){let o=new J(I.comparator);o=o.insert(s,dt.newNoDocument(s,C.min()));let a=F().add(s),u=new Ei(C.min(),new Map,new J(k),o,a);yield Eg(r,u),r.va=r.va.remove(s),r.Fa.delete(t),gl(r)}else yield cr(r.localStore,t,!1).then(()=>dr(r,t,e)).catch(Ke)})}function ew(n,t){return p(this,null,function*(){let e=T(n),r=t.batch.batchId;try{let i=yield D_(e.localStore,t);ml(e,r,null),fl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Ae(e,i)}catch(i){yield Ke(i)}})}function nw(n,t,e){return p(this,null,function*(){let r=T(n);try{let i=yield function(o,a){let u=T(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);ml(r,t,e),fl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Ae(r,i)}catch(i){yield Ke(i)}})}function rw(n,t){return p(this,null,function*(){let e=T(n);Qe(e.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=T(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(r===-1)return void t.resolve();let i=e.Oa.get(r)||[];i.push(t),e.Oa.set(r,i)}catch(r){let i=Ir(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function fl(n,t){(n.Oa.get(t)||[]).forEach(e=>{e.resolve()}),n.Oa.delete(t)}function ml(n,t,e){let r=T(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.xa[r.currentUser.toKey()]=i}}function dr(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Da.get(t))n.ba.delete(r),e&&n.Sa.ka(r,e);n.Da.delete(t),n.isPrimaryClient&&n.Ma.Rr(t).forEach(r=>{n.Ma.containsKey(r)||Tg(n,r)})}function Tg(n,t){n.Ca.delete(t.path.canonicalString());let e=n.va.get(t);e!==null&&(lr(n.remoteStore,e),n.va=n.va.remove(t),n.Fa.delete(e),gl(n))}function bc(n,t,e){for(let r of e)r instanceof vo?(n.Ma.addReference(r.key,t),iw(n,r)):r instanceof Io?(_("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,t),n.Ma.containsKey(r.key)||Tg(n,r.key)):R()}function iw(n,t){let e=t.key,r=e.path.canonicalString();n.va.get(e)||n.Ca.has(r)||(_("SyncEngine","New document in limbo: "+e),n.Ca.add(r),gl(n))}function gl(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let t=n.Ca.values().next().value;n.Ca.delete(t);let e=new I(q.fromString(t)),r=n.Na.next();n.Fa.set(r,new Sc(e)),n.va=n.va.insert(e,r),ko(n.remoteStore,new or(bt(yr(e.path)),r,"TargetPurposeLimboResolution",Nt.oe))}}function Ae(n,t,e){return p(this,null,function*(){let r=T(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=sc.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(u,c){return p(this,null,function*(){let l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.ki,m=>l.persistence.referenceDelegate.addReference(h,d.targetId,m)).next(()=>f.forEach(d.qi,m=>l.persistence.referenceDelegate.removeReference(h,d.targetId,m)))))}catch(h){if(!$e(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let m=l.ts.get(d),S=m.snapshotVersion,w=m.withLastLimboFreeSnapshotVersion(S);l.ts=l.ts.insert(d,w)}}})}(r.localStore,s))})}function sw(n,t){return p(this,null,function*(){let e=T(n);if(!e.currentUser.isEqual(t)){_("SyncEngine","User change. New user:",t.toKey());let r=yield ug(e.localStore,t);e.currentUser=t,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(g.CANCELLED,o))})}),s.Oa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Ae(e,r._s)}})}function ow(n,t){let e=T(n),r=e.Fa.get(t);if(r&&r.wa)return F().add(r.key);{let i=F(),s=e.Da.get(t);if(!s)return i;for(let o of s){let a=e.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function aw(n,t){return p(this,null,function*(){let e=T(n),r=yield co(e.localStore,t.query,!0),i=t.view.pa(r);return e.isPrimaryClient&&bc(e,t.targetId,i.fa),i})}function uw(n,t){return p(this,null,function*(){let e=T(n);return dg(e.localStore,t).then(r=>Ae(e,r))})}function cw(n,t,e,r){return p(this,null,function*(){let i=T(n),s=yield function(a,u){let c=T(a),l=T(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):f.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield wr(i.remoteStore):e==="acknowledged"||e==="rejected"?(ml(i,t,r||null),fl(i,t),function(a,u){T(T(a).mutationQueue).Fn(u)}(i.localStore,t)):R(),yield Ae(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+t)})}function lw(n,t){return p(this,null,function*(){let e=T(n);if(Fo(e),pl(e),t===!0&&e.La!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield Wf(e,r.toArray());e.La=!0,yield yc(e.remoteStore,!0);for(let s of i)ko(e.remoteStore,s)}else if(t===!1&&e.La!==!1){let r=[],i=Promise.resolve();e.Da.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(dr(e,o),cr(e.localStore,o,!0))),lr(e.remoteStore,o)}),yield i,yield Wf(e,r),function(o){let a=T(o);a.Fa.forEach((u,c)=>{lr(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new J(I.comparator)}(e),e.La=!1,yield yc(e.remoteStore,!1)}})}function Wf(n,t,e){return p(this,null,function*(){let r=T(n),i=[],s=[];for(let o of t){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield ur(r.localStore,bt(u[0]));for(let c of u){let l=r.ba.get(c),h=yield aw(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield hg(r.localStore,o);a=yield ur(r.localStore,c),yield dl(r,Ag(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i})}function Ag(n){return Tm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function hw(n){return function(e){return T(T(e).persistence).Li()}(T(n).localStore)}function dw(n,t,e,r){return p(this,null,function*(){let i=T(n);if(i.La)return void _("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield dg(i.localStore,Sm(s[0])),a=Ei.createSynthesizedRemoteEventForCurrentChange(t,e==="current",pt.EMPTY_BYTE_STRING);yield Ae(i,o,a);break}case"rejected":yield cr(i.localStore,t,!0),dr(i,t,r);break;default:R()}})}function fw(n,t,e){return p(this,null,function*(){let r=Fo(n);if(r.La){for(let i of t){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){_("SyncEngine","Adding an already active target "+i);continue}let s=yield hg(r.localStore,i),o=yield ur(r.localStore,s);yield dl(r,Ag(s),o.targetId,!1,o.resumeToken),ko(r.remoteStore,o)}for(let i of e)r.Da.has(i)&&(yield cr(r.localStore,i,!1).then(()=>{lr(r.remoteStore,i),dr(r,i)}).catch(Ke))}})}function Fo(n){let t=T(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Eg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ow.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=tw.bind(null,t),t.Sa.l_=Q_.bind(null,t.eventManager),t.Sa.ka=W_.bind(null,t.eventManager),t}function pl(n){let t=T(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ew.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=nw.bind(null,t),t}function mw(n,t,e){let r=T(n);(function(s,o,a){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(m,S){let w=T(m),v=st(S.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",D=>w.Kr.getBundleMetadata(D,S.id)).then(D=>!!D&&D.createTime.compareTo(v)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(m){return{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(vg(u));let c=new Tc(u,s.localStore,o.serializer),l=yield o.qa();for(;l;){let d=yield c._a(l);d&&a._updateProgress(d),l=yield o.qa()}let h=yield c.complete();return yield Ae(s,h.ca,void 0),yield function(m,S){let w=T(m);return w.persistence.runTransaction("Save bundle","readwrite",v=>w.Kr.saveBundleMetadata(v,S))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.ua)}catch(u){return Ut("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Di=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=qi(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return ag(this.persistence,new uo,t.initialUser,this.serializer)}createPersistence(t){return new oo(ao.jr,this.serializer)}createSharedClientState(t){return new fo}terminate(){return p(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var To=class n extends Di{constructor(t,e,r){super(),this.Qa=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){yield Ho(n.prototype,this,"initialize").call(this,t),yield this.Qa.initialize(this,t),yield pl(this.Qa.syncEngine),yield wr(this.Qa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return ag(this.persistence,new uo,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new zu(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new uu(e,this.persistence);return new au(t.asyncQueue,r)}createPersistence(t){let e=sl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?qt.withCacheSize(this.cacheSizeBytes):qt.DEFAULT;return new ic(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,mg(),ks(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new fo}},Rc=class n extends To{constructor(t,e){super(t,e,!1),this.Qa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return p(this,null,function*(){yield Ho(n.prototype,this,"initialize").call(this,t);let e=this.Qa.syncEngine;this.sharedClientState instanceof di&&(this.sharedClientState.syncEngine={Ys:cw.bind(null,e),Zs:dw.bind(null,e),Xs:fw.bind(null,e),Li:hw.bind(null,e),Js:uw.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>p(this,null,function*(){yield lw(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=mg();if(!di.D(e))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=sl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new di(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Vi=class{initialize(t,e){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Qf(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=sw.bind(null,this.syncEngine),yield yc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new vc}()}createDatastore(t){let e=qi(t.databaseInfo.databaseId),r=function(s){return new hc(s)}(t.databaseInfo);return function(s,o,a,u){return new mc(s,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,i,s,o,a){return new pc(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>Qf(this.syncEngine,e,0),function(){return mo.D()?new mo:new cc}())}createSyncEngine(t,e){return function(i,s,o,a,u,c,l){let h=new xc(i,s,o,a,u,c);return l&&(h.La=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return p(this,null,function*(){var t;yield function(r){return p(this,null,function*(){let i=T(r);_("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield _r(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function Hf(n,t=10240){let e=0;return{read(){return p(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var fr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):rt("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var Pc=class{constructor(t,e){this.Ua=t,this.serializer=e,this.metadata=new ht,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}qa(){return p(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return p(this,null,function*(){let t=yield this.za();if(t===null)return null;let e=this.Wa.decode(t),r=Number(e);isNaN(r)&&this.ja(`length string (${e}) is not valid number`);let i=yield this.Ha(r);return new Ec(JSON.parse(i),t.length+r)})}Ja(){return this.buffer.findIndex(t=>t===123)}za(){return p(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let t=this.Ja();t<0&&this.ja("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Ha(t){return p(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let e=this.Wa.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ja(t){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${t}`)}Ya(){return p(this,null,function*(){let t=yield this.Ua.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var Cc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return p(this,null,function*(){let o=T(i),a={documents:s.map(h=>Ai(o.serializer,h))},u=yield o.Mo("BatchGetDocuments",o.serializer.databaseId,q.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=w_(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());P(!!d),l.push(d)}),l})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ge(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=I.fromPath(r);this.mutations.push(new wi(i,this.precondition(i)))}),yield function(r,i){return p(this,null,function*(){let s=T(r),o={writes:i.map(a=>Si(s.serializer,a))};yield s.Do("Commit",s.serializer.databaseId,q.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw R();e=C.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(C.min())?nt.exists(!1):nt.updateTime(e):nt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(C.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nt.updateTime(e)}return nt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Dc=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new Pi(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko(()=>p(this,null,function*(){let t=new Cc(this.datastore),e=this.tu(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(t){try{let e=this.updateFunction(t);return!Fi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(t){this.Za>0&&this.ru(t)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(t)}ru(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!qm(e)}return!1}};var Vc=class{constructor(t,e,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=lt.UNAUTHENTICATED,this.clientId=Ls.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>p(this,null,function*(){_("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Ir(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Fs(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield ug(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Nc(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield yl(n);_("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Kf(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Kf(t.remoteStore,i)),n._onlineComponents=t})}function Sg(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function yl(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Fs(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!Sg(e))throw e;Ut("Error using user provided cache. Falling back to memory cache: "+e),yield Fs(n,new Di)}}else _("FirestoreClient","Using default OfflineComponentProvider"),yield Fs(n,new Di);return n._offlineComponents})}function Mo(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),yield Nc(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),yield Nc(n,new Vi))),n._onlineComponents})}function xg(n){return yl(n).then(t=>t.persistence)}function _l(n){return yl(n).then(t=>t.localStore)}function bg(n){return Mo(n).then(t=>t.remoteStore)}function wl(n){return Mo(n).then(t=>t.syncEngine)}function gw(n){return Mo(n).then(t=>t.datastore)}function mr(n){return p(this,null,function*(){let t=yield Mo(n),e=t.eventManager;return e.onListen=H_.bind(null,t.syncEngine),e.onUnlisten=Y_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=J_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=X_.bind(null,t.syncEngine),e})}function pw(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield xg(n),e=yield bg(n);return t.setNetworkEnabled(!0),function(i){let s=T(i);return s.M_.delete(0),Ui(s)}(e)}))}function yw(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield xg(n),e=yield bg(n);return t.setNetworkEnabled(!1),function(i){return p(this,null,function*(){let s=T(i);s.M_.add(0),yield _r(s),s.N_.set("Offline")})}(e)}))}function _w(n,t){let e=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield function(c,l){let h=T(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Ir(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield _l(n),t,e)})),e.promise}function Rg(n,t,e={}){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new fr({next:d=>{o.enqueueAndForget(()=>ll(s,h));let m=d.docs.has(a);!m&&d.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&u&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Ci(yr(a.path),l,{includeMetadataChanges:!0,ra:!0});return cl(s,h)}(yield mr(n),n.asyncQueue,t,e,r)})),r.promise}function ww(n,t){let e=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield co(i,s,!0),u=new Eo(s,a.ls),c=u.da(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Ir(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield _l(n),t,e)})),e.promise}function Pg(n,t,e={}){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new fr({next:d=>{o.enqueueAndForget(()=>ll(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Ci(a,l,{includeMetadataChanges:!0,ra:!0});return cl(s,h)}(yield mr(n),n.asyncQueue,t,e,r)})),r.promise}function vw(n,t){let e=new fr(t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){T(i).z_.add(s),s.next()}(yield mr(n),e)})),()=>{e.$a(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){T(i).z_.delete(s)}(yield mr(n),e)}))}}function Iw(n,t,e,r){let i=function(o,a){let u;return u=typeof o=="string"?Bm().encode(o):o,function(l,h){return new Pc(l,h)}(function(l,h){if(l instanceof Uint8Array)return Hf(l,h);if(l instanceof ArrayBuffer)return Hf(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(e,qi(t));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){mw(yield wl(n),i,r)}))}function Ew(n,t){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return function(r,i){let s=T(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield _l(n),t)}))}function Cg(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Jf=new Map;function vl(n,t,e){if(!e)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Il(n,t,e,r){if(t===!0&&r===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Yf(n){if(!I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xf(n){if(I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Lo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":R()}function U(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Lo(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Dg(n,t){if(t<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Ao=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Il("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cg((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},_n=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ao({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ao(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ya;switch(r.type){case"firstParty":return new eu(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Jf.get(e);r&&(_("ComponentProvider","Removing Datastore"),Jf.delete(e),r.terminate())}(this),Promise.resolve()}};function Vg(n,t,e,r={}){var i;let s=(n=U(n,_n))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=lt.MOCK_USER;else{a=th(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new lt(c)}n._authCredentials=new Xa(new Ms(a,u))}}var vt=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},W=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ae(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},ae=class n extends vt{constructor(t,e,r){super(t,e,yr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new W(this.firestore,null,new I(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function El(n,t,...e){if(n=Z(n),vl("collection","path",t),n instanceof _n){let r=q.fromString(t,...e);return Xf(r),new ae(n,null,r)}{if(!(n instanceof W||n instanceof ae))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(q.fromString(t,...e));return Xf(r),new ae(n.firestore,null,r)}}function Ng(n,t){if(n=U(n,_n),vl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vt(n,null,function(r){return new $t(q.emptyPath(),r)}(t))}function Bi(n,t,...e){if(n=Z(n),arguments.length===1&&(t=Ls.newId()),vl("doc","path",t),n instanceof _n){let r=q.fromString(t,...e);return Yf(r),new W(n,null,new I(r))}{if(!(n instanceof W||n instanceof ae))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(q.fromString(t,...e));return Yf(r),new W(n.firestore,n instanceof ae?n.converter:null,new I(r))}}function Tl(n,t){return n=Z(n),t=Z(t),(n instanceof W||n instanceof ae)&&(t instanceof W||t instanceof ae)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Al(n,t){return n=Z(n),t=Z(t),n instanceof vt&&t instanceof vt&&n.firestore===t.firestore&&Li(n._query,t._query)&&n.converter===t.converter}var kc=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Pi(this,"async_queue_retry"),this.hu=()=>{let e=ks();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Jo.Uo()};let t=ks();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;let e=ks();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise(()=>{});let e=new ht;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.su.push(t),this.Tu()))}Tu(){return p(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!$e(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(t){let e=this.iu.then(()=>(this.uu=!0,t().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw rt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=e,e}enqueueAfterDelay(t,e,r){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);let i=_c.createAndSchedule(this,t,e,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&R()}verifyOperationInProgress(){}du(){return p(this,null,function*(){let t;do t=this.iu,yield t;while(t!==this.iu)})}Au(t){for(let e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then(()=>{this._u.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this._u)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.du()})}Vu(t){this.lu.push(t)}Eu(t){let e=this._u.indexOf(t);this._u.splice(e,1)}};function Fc(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Mc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ht,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var kg=-1,Y=class extends _n{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=function(){return new kc}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Fg(this),this._firestoreClient.terminate()}};function ft(n){return n._firestoreClient||Fg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Fg(n){var t,e,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new cu(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Cg(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Vc(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Mg(n,t){Kg(n=U(n,Y));let e=ft(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Vi;return Og(e,i,new To(i,r.cacheSizeBytes,t?.forceOwnership))}function Lg(n){Kg(n=U(n,Y));let t=ft(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Vi;return Og(t,r,new Rc(r,e.cacheSizeBytes))}function Og(n,t,e){let r=new ht;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield Fs(n,e),yield Nc(n,t),r.resolve()}catch(i){let s=i;if(!Sg(s))throw s;Ut("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function qg(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new ht;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield function(r){return p(this,null,function*(){if(!Me.D())return Promise.resolve();let i=r+"main";yield Me.delete(i)})}(sl(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Ug(n){return function(e){let r=new ht;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return rw(yield wl(e),r)})),r.promise}(ft(n=U(n,Y)))}function Bg(n){return pw(ft(n=U(n,Y)))}function jg(n){return yw(ft(n=U(n,Y)))}function Gg(n,t){let e=ft(n=U(n,Y)),r=new Mc;return Iw(e,n._databaseId,t,r),r}function zg(n,t){return Ew(ft(n=U(n,Y)),t).then(e=>e?new vt(n,null,e.query):null)}function Kg(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var he=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(pt.fromBase64String(t))}catch(e){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Wt=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ee=class{constructor(t){this._methodName=t}};var wn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return k(this._lat,t._lat)||k(this._long,t._long)}};var Tw=/^__.*__$/,Lc=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms):new je(t,this.data,e,this.fieldTransforms)}},So=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function $g(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}var xo=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:r,yu:!1});return i.wu(t),i}Su(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return bo(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(t.length===0)throw this.Du("Document fields must not be empty");if($g(this.fu)&&Tw.test(t))throw this.Du('Document fields cannot begin and end with "__"')}},Oc=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||qi(t)}Fu(t,e,r,i=!1){return new xo({fu:t,methodName:e,vu:r,path:it.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Tn(n){let t=n._freezeSettings(),e=qi(n._databaseId);return new Oc(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Oo(n,t,e,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,t,e,i);bl("Data must be an object, but it was:",o,r);let a=Hg(r,o),u,c;if(s.merge)u=new kt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Gc(t,h,e);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Yg(l,d)||l.push(d)}u=new kt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Lc(new At(a),u,c)}var Ni=class n extends Ee{_toFieldTransform(t){if(t.fu!==2)throw t.fu===1?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function Qg(n,t,e){return new xo({fu:3,vu:t.settings.vu,methodName:n._methodName,yu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var qc=class n extends Ee{_toFieldTransform(t){return new gn(t.path,new Ue)}isEqual(t){return t instanceof n}},Uc=class n extends Ee{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Qg(this,t,!0),r=this.Mu.map(s=>An(s,e)),i=new ve(r);return new gn(t.path,i)}isEqual(t){return t instanceof n&&ta(this.Mu,t.Mu)}},Bc=class n extends Ee{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Qg(this,t,!0),r=this.Mu.map(s=>An(s,e)),i=new Ie(r);return new gn(t.path,i)}isEqual(t){return t instanceof n&&ta(this.Mu,t.Mu)}},jc=class n extends Ee{constructor(t,e){super(t),this.xu=e}_toFieldTransform(t){let e=new Be(t.serializer,Vm(t.serializer,this.xu));return new gn(t.path,e)}isEqual(t){return t instanceof n&&this.xu===t.xu}};function Sl(n,t,e,r){let i=n.Fu(1,t,e);bl("Data must be an object, but it was:",i,r);let s=[],o=At.empty();En(r,(u,c)=>{let l=Rl(t,u,e);c=Z(c);let h=i.Su(l);if(c instanceof Ni)s.push(l);else{let d=An(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new kt(s);return new So(o,a,i.fieldTransforms)}function xl(n,t,e,r,i,s){let o=n.Fu(1,t,e),a=[Gc(t,r,e)],u=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Gc(t,s[d])),u.push(s[d+1]);let c=[],l=At.empty();for(let d=a.length-1;d>=0;--d)if(!Yg(c,a[d])){let m=a[d],S=u[d];S=Z(S);let w=o.Su(m);if(S instanceof Ni)c.push(m);else{let v=An(S,w);v!=null&&(c.push(m),l.set(m,v))}}let h=new kt(c);return new So(l,h,o.fieldTransforms)}function Wg(n,t,e,r=!1){return An(e,n.Fu(r?4:3,t))}function An(n,t){if(Jg(n=Z(n)))return bl("Unsupported field value:",t,n),Hg(n,t);if(n instanceof Ee)return function(r,i){if(!$g(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.yu&&t.fu!==4)throw t.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=An(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if((r=Z(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Vm(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=X.fromDate(r);return{timestampValue:sr(i.serializer,s)}}if(r instanceof X){let s=new X(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:sr(i.serializer,s)}}if(r instanceof wn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof he)return{bytesValue:jm(i.serializer,r._byteString)};if(r instanceof W){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:nl(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Lo(r)}`)}(n,t)}function Hg(n,t){let e={};return mm(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):En(n,(r,i)=>{let s=An(i,t.pu(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function Jg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof X||n instanceof wn||n instanceof he||n instanceof W||n instanceof Ee)}function bl(n,t,e){if(!Jg(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=Lo(e);throw r==="an object"?t.Du(n+" a custom object"):t.Du(n+" "+r)}}function Gc(n,t,e){if((t=Z(t))instanceof Wt)return t._internalPath;if(typeof t=="string")return Rl(n,t);throw bo("Field path arguments must be of type string or ",n,!1,void 0,e)}var Aw=new RegExp("[~\\*/\\[\\]]");function Rl(n,t,e){if(t.search(Aw)>=0)throw bo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Wt(...t.split("."))._internalPath}catch{throw bo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function bo(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(g.INVALID_ARGUMENT,a+n+u)}function Yg(n,t){return n.some(e=>e.isEqual(t))}var vn=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new W(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new zc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(qo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},zc=class extends vn{data(){return super.data()}};function qo(n,t){return typeof t=="string"?Rl(n,t):t instanceof Wt?t._internalPath:t._delegate._internalPath}function Xg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ki=class{},In=class extends ki{};function Se(n,t,...e){let r=[];t instanceof ki&&r.push(t),r=r.concat(e),function(s){let o=s.filter(u=>u instanceof Kc).length,a=s.filter(u=>u instanceof Ro).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Ro=class n extends In{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return up(t._query,e),new vt(t.firestore,t.converter,Eu(t._query,e))}_parse(t){let e=Tn(t.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){tm(h,l);let m=[];for(let S of h)m.push(Zf(u,s,S));d={arrayValue:{values:m}}}else d=Zf(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||tm(h,l),d=Wg(a,o,h,l==="in"||l==="not-in");return L.create(c,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Zg(n,t,e){let r=t,i=qo("where",n);return Ro._create(i,r,e)}var Kc=class n extends ki{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:$.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)up(o,u),o=Eu(o,u)}(t._query,e),new vt(t.firestore,t.converter,Eu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var $c=class n extends In{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(i,s,o){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fn(s,o)}(t._query,this._field,this._direction);return new vt(t.firestore,t.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new $t(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function tp(n,t="asc"){let e=t,r=qo("orderBy",n);return $c._create(r,e)}var Po=class n extends In{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new vt(t.firestore,t.converter,Qs(t._query,this._limit,this._limitType))}};function ep(n){return Dg("limit",n),Po._create("limit",n,"F")}function np(n){return Dg("limitToLast",n),Po._create("limitToLast",n,"L")}var Co=class n extends In{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=ap(t,this.type,this._docOrFields,this._inclusive);return new vt(t.firestore,t.converter,function(i,s){return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function rp(...n){return Co._create("startAt",n,!0)}function ip(...n){return Co._create("startAfter",n,!1)}var Do=class n extends In{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=ap(t,this.type,this._docOrFields,this._inclusive);return new vt(t.firestore,t.converter,function(i,s){return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function sp(...n){return Do._create("endBefore",n,!1)}function op(...n){return Do._create("endAt",n,!0)}function ap(n,t,e,r){if(e[0]=Z(e[0]),e[0]instanceof vn)return function(s,o,a,u,c){if(!u)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Yn(s))if(h.field.isKeyField())l.push(dn(o,u.key));else{let d=u.data.field(h.field);if(No(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let m=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}l.push(d)}return new ce(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=Tn(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let m=[];for(let S=0;S<l.length;S++){let w=l[S];if(d[S].field.isKeyField()){if(typeof w!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!tl(o)&&w.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let v=o.path.child(q.fromString(w));if(!I.isDocumentKey(v))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${v}' is not because it contains an odd number of segments.`);let D=new I(v);m.push(dn(a,D))}else{let v=Wg(u,c,w);m.push(v)}}return new ce(m,h)}(n._query,n.firestore._databaseId,i,t,e,r)}}function Zf(n,t,e){if(typeof(e=Z(e))=="string"){if(e==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tl(t)&&e.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(q.fromString(e));if(!I.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return dn(n,new I(r))}if(e instanceof W)return dn(n,e._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Lo(e)}.`)}function tm(n,t){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function up(n,t){let e=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var gr=class{convertValue(t,e="none"){switch(hn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return et(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw R()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return En(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertGeoPoint(t){return new wn(et(t.latitude),et(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Xc(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(pi(t));default:return null}}convertTimestamp(t){let e=we(t);return new X(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=q.fromString(t);P(Zm(r));let i=new Oe(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(e)||rt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Uo(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Qc=class extends gr{constructor(t){super(),this.firestore=t}convertBytes(t){return new he(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new W(this.firestore,null,e)}};var _e=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},jt=class extends vn{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new ke(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(qo("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},ke=class extends jt{data(t={}){return super.data(t)}},Ht=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new _e(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new ke(this._firestore,this._userDataWriter,r.key,r,new _e(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new ke(i._firestore,i._userDataWriter,a.doc.key,a.doc,new _e(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new ke(i._firestore,i._userDataWriter,a.doc.key,a.doc,new _e(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Sw(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Sw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function Pl(n,t){return n instanceof jt&&t instanceof jt?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Ht&&t instanceof Ht&&n._firestore===t._firestore&&Al(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function cp(n){n=U(n,W);let t=U(n.firestore,Y);return Rg(ft(t),n._key).then(e=>Nl(t,n,e))}var Te=class extends gr{constructor(t){super(),this.firestore=t}convertBytes(t){return new he(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new W(this.firestore,null,e)}};function lp(n){n=U(n,W);let t=U(n.firestore,Y),e=ft(t),r=new Te(t);return _w(e,n._key).then(i=>new jt(t,r,n._key,i,new _e(i!==null&&i.hasLocalMutations,!0),n.converter))}function hp(n){n=U(n,W);let t=U(n.firestore,Y);return Rg(ft(t),n._key,{source:"server"}).then(e=>Nl(t,n,e))}function dp(n){n=U(n,vt);let t=U(n.firestore,Y),e=ft(t),r=new Te(t);return Xg(n._query),Pg(e,n._query).then(i=>new Ht(t,r,n,i))}function fp(n){n=U(n,vt);let t=U(n.firestore,Y),e=ft(t),r=new Te(t);return ww(e,n._query).then(i=>new Ht(t,r,n,i))}function mp(n){n=U(n,vt);let t=U(n.firestore,Y),e=ft(t),r=new Te(t);return Pg(e,n._query,{source:"server"}).then(i=>new Ht(t,r,n,i))}function Cl(n,t,e){n=U(n,W);let r=U(n.firestore,Y),i=Uo(n.converter,t,e);return Er(r,[Oo(Tn(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,nt.none())])}function Dl(n,t,e,...r){n=U(n,W);let i=U(n.firestore,Y),s=Tn(i),o;return o=typeof(t=Z(t))=="string"||t instanceof Wt?xl(s,"updateDoc",n._key,t,e,r):Sl(s,"updateDoc",n._key,t),Er(i,[o.toMutation(n._key,nt.exists(!0))])}function gp(n){return Er(U(n.firestore,Y),[new Ge(n._key,nt.none())])}function pp(n,t){let e=U(n.firestore,Y),r=Bi(n),i=Uo(n.converter,t);return Er(e,[Oo(Tn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,nt.exists(!1))]).then(()=>r)}function Vl(n,...t){var e,r,i;n=Z(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||Fc(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Fc(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof W)c=U(n.firestore,Y),l=yr(n._key.path),u={next:h=>{t[o]&&t[o](Nl(c,n,h))},error:t[o+1],complete:t[o+2]};else{let h=U(n,vt);c=U(h.firestore,Y),l=h._query;let d=new Te(c);u={next:m=>{t[o]&&t[o](new Ht(c,d,h,m))},error:t[o+1],complete:t[o+2]},Xg(n._query)}return function(d,m,S,w){let v=new fr(w),D=new Ci(m,v,S);return d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return cl(yield mr(d),D)})),()=>{v.$a(),d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ll(yield mr(d),D)}))}}(ft(c),l,a,u)}function yp(n,t){return vw(ft(n=U(n,Y)),Fc(t)?t:{next:t})}function Er(n,t){return function(r,i){let s=new ht;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Z_(yield wl(r),i,s)})),s.promise}(ft(n),t)}function Nl(n,t,e){let r=e.docs.get(t._key),i=new Te(n);return new jt(n,i,t._key,r,new _e(e.hasPendingWrites,e.fromCache),t.converter)}var xw={maxAttempts:5};var Vo=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Tn(t)}set(t,e,r){this._verifyNotCommitted();let i=Ve(t,this._firestore),s=Uo(i.converter,e,r),o=Oo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,nt.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=Ve(t,this._firestore),o;return o=typeof(e=Z(e))=="string"||e instanceof Wt?xl(this._dataReader,"WriteBatch.update",s._key,e,r,i):Sl(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,nt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ve(t,this._firestore);return this._mutations=this._mutations.concat(new Ge(e._key,nt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ve(n,t){if((n=Z(n)).firestore!==t)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Wc=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=Tn(e)}get(e){let r=Ve(e,this._firestore),i=new Qc(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return R();let o=s[0];if(o.isFoundDocument())return new vn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new vn(this._firestore,i,r._key,null,r.converter);throw R()})}set(e,r,i){let s=Ve(e,this._firestore),o=Uo(s.converter,r,i),a=Oo(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(e,r,i,...s){let o=Ve(e,this._firestore),a;return a=typeof(r=Z(r))=="string"||r instanceof Wt?xl(this._dataReader,"Transaction.update",o._key,r,i,s):Sl(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){let r=Ve(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ve(t,this._firestore),r=new Te(this._firestore);return super.get(t).then(i=>new jt(this._firestore,r,e._key,i._document,new _e(!1,!1),e.converter))}};function _p(n,t,e){n=U(n,Y);let r=Object.assign(Object.assign({},xw),e);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new ht;return s.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let c=yield gw(s);new Dc(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(ft(n),i=>t(new Wc(n,i)),r)}function wp(){return new Ni("deleteField")}function vp(){return new qc("serverTimestamp")}function Ip(...n){return new Uc("arrayUnion",n)}function Ep(...n){return new Bc("arrayRemove",n)}function Tp(n){return new jc("increment",n)}(function(t,e=!0){(function(i){pr=i})(sh),ih(new Ji("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Y(new Za(r.getProvider("auth-internal")),new ru(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Oe(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ea(tf,"4.6.1",t),ea(tf,"4.6.1","esm2017")})();var bw="@firebase/firestore-compat",Rw="0.3.30";function ql(n,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return t}function Ap(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Sp(){if(!gm())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Bo=class n{constructor(t){this._delegate=t}static fromBase64String(t){return Sp(),new n(he.fromBase64String(t))}static fromUint8Array(t){return Ap(),new n(he.fromUint8Array(t))}toBase64(){return Sp(),this._delegate.toBase64()}toUint8Array(){return Ap(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function kl(n){return Pw(n,["next","error","complete"])}function Pw(n,t){if(typeof n!="object"||n===null)return!1;let e=n;for(let r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}var Fl=class{enableIndexedDbPersistence(t,e){return Mg(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Lg(t._delegate)}clearIndexedDbPersistence(t){return qg(t._delegate)}},jo=class{constructor(t,e,r){this._delegate=e,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},t instanceof Oe||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&Ut("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,r={}){Vg(this._delegate,t,e,r)}enableNetwork(){return Bg(this._delegate)}disableNetwork(){return jg(this._delegate)}enablePersistence(t){let e=!1,r=!1;return t&&(e=!!t.synchronizeTabs,r=!!t.experimentalForceOwningTab,Il("synchronizeTabs",e,"experimentalForceOwningTab",r)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ug(this._delegate)}onSnapshotsInSync(t){return yp(this._delegate,t)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Sr(this,El(this._delegate,t))}catch(e){throw Rt(e,"collection()","Firestore.collection()")}}doc(t){try{return new de(this,Bi(this._delegate,t))}catch(e){throw Rt(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new Rn(this,Ng(this._delegate,t))}catch(e){throw Rt(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return _p(this._delegate,e=>t(new Go(this,e)))}batch(){return ft(this._delegate),new zo(new Vo(this._delegate,t=>Er(this._delegate,t)))}loadBundle(t){return Gg(this._delegate,t)}namedQuery(t){return zg(this._delegate,t).then(e=>e?new Rn(this,e):null)}},Tr=class extends gr{constructor(t){super(),this.firestore=t}convertBytes(t){return new Bo(new he(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return de.forKey(e,this.firestore,null)}};function Cw(n){em(n)}var Go=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Tr(t)}get(t){let e=Sn(t);return this._delegate.get(e).then(r=>new xn(this._firestore,new jt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,e.converter)))}set(t,e,r){let i=Sn(t);return r?(ql("Transaction.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=Sn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=Sn(t);return this._delegate.delete(e),this}},zo=class{constructor(t){this._delegate=t}set(t,e,r){let i=Sn(t);return r?(ql("WriteBatch.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=Sn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=Sn(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Ar=class n{constructor(t,e,r){this._firestore=t,this._userDataWriter=e,this._delegate=r}fromFirestore(t,e){let r=new ke(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new bn(this._firestore,r),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let r=n.INSTANCES,i=r.get(t);i||(i=new WeakMap,r.set(t,i));let s=i.get(e);return s||(s=new n(t,new Tr(t),e),i.set(e,s)),s}};Ar.INSTANCES=new WeakMap;var de=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Tr(t)}static forPath(t,e,r){if(t.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new n(e,new W(e._delegate,r,new I(t)))}static forKey(t,e,r){return new n(e,new W(e._delegate,r,t))}get id(){return this._delegate.id}get parent(){return new Sr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Sr(this.firestore,El(this._delegate,t))}catch(e){throw Rt(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=Z(t),t instanceof W?Tl(this._delegate,t):!1}set(t,e){e=ql("DocumentReference.set",e);try{return e?Cl(this._delegate,t,e):Cl(this._delegate,t)}catch(r){throw Rt(r,"setDoc()","DocumentReference.set()")}}update(t,e,...r){try{return arguments.length===1?Dl(this._delegate,t):Dl(this._delegate,t,e,...r)}catch(i){throw Rt(i,"updateDoc()","DocumentReference.update()")}}delete(){return gp(this._delegate)}onSnapshot(...t){let e=xp(t),r=bp(t,i=>new xn(this.firestore,new jt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Vl(this._delegate,e,r)}get(t){let e;return t?.source==="cache"?e=lp(this._delegate):t?.source==="server"?e=hp(this._delegate):e=cp(this._delegate),e.then(r=>new xn(this.firestore,new jt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Ar.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Rt(n,t,e){return n.message=n.message.replace(t,e),n}function xp(n){for(let t of n)if(typeof t=="object"&&!kl(t))return t;return{}}function bp(n,t){var e,r;let i;return kl(n[0])?i=n[0]:kl(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var xn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new de(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Pl(this._delegate,t._delegate)}},bn=class extends xn{data(t){let e=this._delegate.data(t);return this._delegate._converter||nm(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},Rn=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Tr(t)}where(t,e,r){try{return new n(this.firestore,Se(this._delegate,Zg(t,e,r)))}catch(i){throw Rt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new n(this.firestore,Se(this._delegate,tp(t,e)))}catch(r){throw Rt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new n(this.firestore,Se(this._delegate,ep(t)))}catch(e){throw Rt(e,"limit()","Query.limit()")}}limitToLast(t){try{return new n(this.firestore,Se(this._delegate,np(t)))}catch(e){throw Rt(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new n(this.firestore,Se(this._delegate,rp(...t)))}catch(e){throw Rt(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new n(this.firestore,Se(this._delegate,ip(...t)))}catch(e){throw Rt(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new n(this.firestore,Se(this._delegate,sp(...t)))}catch(e){throw Rt(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new n(this.firestore,Se(this._delegate,op(...t)))}catch(e){throw Rt(e,"endAt()","Query.endAt()")}}isEqual(t){return Al(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=fp(this._delegate):t?.source==="server"?e=mp(this._delegate):e=dp(this._delegate),e.then(r=>new ji(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...t){let e=xp(t),r=bp(t,i=>new ji(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Vl(this._delegate,e,r)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Ar.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},Ml=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new bn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ji=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new Rn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new bn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new Ml(this._firestore,e))}forEach(t,e){this._delegate.forEach(r=>{t.call(e,new bn(this._firestore,r))})}isEqual(t){return Pl(this._delegate,t._delegate)}},Sr=class n extends Rn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new de(this.firestore,t):null}doc(t){try{return t===void 0?new de(this.firestore,Bi(this._delegate)):new de(this.firestore,Bi(this._delegate,t))}catch(e){throw Rt(e,"doc()","CollectionReference.doc()")}}add(t){return pp(this._delegate,t).then(e=>new de(this.firestore,e))}isEqual(t){return Tl(this._delegate,t._delegate)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Ar.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Sn(n){return U(n,W)}var Ll=class n{constructor(...t){this._delegate=new Wt(...t)}static documentId(){return new n(it.keyField().canonicalString())}isEqual(t){return t=Z(t),t instanceof Wt?this._delegate._internalPath.isEqual(t._internalPath):!1}};var Ol=class n{constructor(t){this._delegate=t}static serverTimestamp(){let t=vp();return t._methodName="FieldValue.serverTimestamp",new n(t)}static delete(){let t=wp();return t._methodName="FieldValue.delete",new n(t)}static arrayUnion(...t){let e=Ip(...t);return e._methodName="FieldValue.arrayUnion",new n(e)}static arrayRemove(...t){let e=Ep(...t);return e._methodName="FieldValue.arrayRemove",new n(e)}static increment(t){let e=Tp(t);return e._methodName="FieldValue.increment",new n(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var Dw={Firestore:jo,GeoPoint:wn,Timestamp:X,Blob:Bo,Transaction:Go,WriteBatch:zo,DocumentReference:de,DocumentSnapshot:xn,Query:Rn,QueryDocumentSnapshot:bn,QuerySnapshot:ji,CollectionReference:Sr,FieldPath:Ll,FieldValue:Ol,setLogLevel:Cw,CACHE_SIZE_UNLIMITED:kg};function Vw(n,t){n.INTERNAL.registerComponent(new Ji("firestore-compat",e=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(r,i)},"PUBLIC").setServiceProps(Object.assign({},Dw)))}function Nw(n){Vw(n,(t,e)=>new jo(t,e,new Fl)),n.registerVersion(bw,Rw)}Nw(na);function kw(n,t=$l){return new Kl(e=>{let r;return t!=null?t.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},e)}):r=n.onSnapshot({includeMetadataChanges:!0},e),()=>{r?.()}})}function Rp(n,t){return kw(n,t)}function Fw(n,t){return Rp(n,t).pipe(Ki(void 0),Gi(),Dt(e=>{let[r,i]=e;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function jl(n,t){return Rp(n,t).pipe(Dt(e=>({payload:e,type:"query"})))}var Ko=class{ref;afs;constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let r=this.ref.collection(t),{ref:i,query:s}=Dp(r,e);return new Qo(i,s,this.afs)}snapshotChanges(){return Fw(this.ref,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(t={}){return this.snapshotChanges().pipe(Dt(({payload:e})=>t.idField?br(Pn({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return fe(this.ref.get(t)).pipe(Lt)}};function $o(n,t){return jl(n,t).pipe(Ki(void 0),Gi(),Dt(e=>{let[r,i]=e,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function Pp(n,t,e){return $o(n,e).pipe(zi((r,i)=>Mw(r,i.map(s=>s.payload),t),[]),Ql(),Dt(r=>r.map(i=>({type:i.type,payload:i}))))}function Mw(n,t,e){return t.forEach(r=>{e.indexOf(r.type)>-1&&(n=Lw(n,r))}),n}function Ul(n,t,e,...r){let i=n.slice();return i.splice(t,e,...r),i}function Lw(n,t){switch(t.type){case"added":if(!(n[t.newIndex]&&n[t.newIndex].doc.ref.isEqual(t.doc.ref)))return Ul(n,t.newIndex,0,t);break;case"modified":if(n[t.oldIndex]==null||n[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=n.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return Ul(n,t.newIndex,1,t);break;case"removed":if(n[t.oldIndex]&&n[t.oldIndex].doc.ref.isEqual(t.doc.ref))return Ul(n,t.oldIndex,1);break}return n}function Cp(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Qo=class{ref;query;afs;constructor(t,e,r){this.ref=t,this.query=e,this.afs=r}stateChanges(t){let e=$o(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Dt(r=>r.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(Ki(void 0),Gi(),Jo(([r,i])=>i.length>0||!r),Dt(([,r])=>r),Lt)}auditTrail(t){return this.stateChanges(t).pipe(zi((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Cp(t);return Pp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(t={}){return jl(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(e=>e.payload.docs.map(r=>t.idField?br(Pn({},r.data()),{[t.idField]:r.id}):r.data())),Lt)}get(t){return fe(this.query.get(t)).pipe(Lt)}add(t){return this.ref.add(t)}doc(t){return new Ko(this.ref.doc(t),this.afs)}},Bl=class{query;afs;constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?$o(this.query,this.afs.schedulers.outsideAngular).pipe(Lt):$o(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(e=>e.filter(r=>t.indexOf(r.type)>-1)),Jo(e=>e.length>0),Lt)}auditTrail(t){return this.stateChanges(t).pipe(zi((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Cp(t);return Pp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Lt)}valueChanges(t={}){return jl(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(r=>r.payload.docs.map(i=>t.idField?Pn({[t.idField]:i.id},i.data()):i.data())),Lt)}get(t){return fe(this.query.get(t)).pipe(Lt)}},Ow=new Cr("angularfire2.enableFirestorePersistence"),qw=new Cr("angularfire2.firestore.persistenceSettings"),Uw=new Cr("angularfire2.firestore.settings"),Bw=new Cr("angularfire2.firestore.use-emulator");function Dp(n,t=e=>e){return{query:t(n),ref:n}}var xr=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(e,r,i,s,o,a,u,c,l,h,d,m,S,w,v,D,M){this.schedulers=u;let V=lh(e,a,r),j=l;h&&_h(V,a,d,S,w,v,m,D),[this.firestore,this.persistenceEnabled$]=hh(`${V.name}.firestore`,"AngularFirestore",V.name,()=>{let G=a.runOutsideAngular(()=>V.firestore());if(s&&G.settings(s),j&&G.useEmulator(...j),i&&!Xl(o)){let B=()=>{try{return fe(G.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ot){return typeof console<"u"&&console.warn(ot),Cn(!1)}};return[G,a.runOutsideAngular(B)]}else return[G,Cn(!1)]},[s,j,i])}collection(e,r){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:o}=Dp(i,r),a=this.schedulers.ngZone.run(()=>s);return new Qo(a,o,this)}collectionGroup(e,r){let i=r||(o=>o),s=this.firestore.collectionGroup(e);return new Bl(i(s),this)}doc(e){let r;typeof e=="string"?r=this.firestore.doc(e):r=e;let i=this.schedulers.ngZone.run(()=>r);return new Ko(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(at(uh),at(ch,8),at(Ow,8),at(Uw,8),at(Wl),at(Hl),at(ah),at(qw,8),at(Bw,8),at(wh,8),at(dh,8),at(fh,8),at(mh,8),at(gh,8),at(ph,8),at(yh,8),at(oh,8))};static \u0275prov=$i({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Wo=(()=>{let t=class t{constructor(r){this.firestore=r}setCollection(r){this.collection=this.firestore.collection(r)}getDocuments(){if(!this.collection)throw new Error("Collection path not set.");return this.collection.snapshotChanges().pipe(Dt(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return br(Pn({},s),{id:o})})),Rr(r=>{throw console.error("Error obtaining data from Firestore:",r),r}))}addDocument(r){return fe(this.collection.add(r)).pipe(Yo(i=>this.collection.doc(i.id).valueChanges()))}updateDocument(r,i){return fe(this.collection.doc(r).update(i)).pipe(Rr(s=>{throw console.error("Error updating document in Firestore:",s),s}))}deleteDocument(r){return fe(this.collection.doc(r).delete()).pipe(Rr(i=>{throw console.error("Error deleting document from Firestore:",i),i}))}getDocumentById(r){return this.collection.doc(r).get().pipe(Yo(i=>{if(i.exists){let s=i.data();return Cn(s)}else return console.error("Document with provided ID does not exist:",r),Cn(void 0)}),Rr(i=>{throw console.error("Error getting document by ID:",i),i}))}};t.\u0275fac=function(i){return new(i||t)(at(xr))},t.\u0275prov=$i({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function Gw(n,t){if(n&1){let e=Vn();x(0,"tr",10)(1,"td",8),b(2),E(),x(3,"td",8)(4,"button",11),Mt("click",function(){let i=We(e).$implicit,s=Xt(2);return He(s.mostrarDetalle(i))}),b(5,"Ver"),E()()()}if(n&2){let e=t.$implicit;z(2),xe(e.title)}}function zw(n,t){if(n&1&&(x(0,"table",6)(1,"thead",7)(2,"tr")(3,"th",8),b(4,"Title"),E(),x(5,"th",8),b(6,"Details"),E()()(),x(7,"tbody"),Yt(8,Gw,6,1,"tr",9),E()()),n&2){let e=Xt();z(8),Gt("ngForOf",e.projects)}}function Kw(n,t){if(n&1&&(x(0,"li",23),b(1),E()),n&2){let e=t.$implicit;z(),xe(e)}}function $w(n,t){if(n&1&&(x(0,"li",23),b(1),E()),n&2){let e=t.$implicit;z(),Jl("",e.src," - ",e.description,"")}}function Qw(n,t){if(n&1){let e=Vn();x(0,"div",12)(1,"div",13)(2,"h2",14),b(3),E(),x(4,"p",15),b(5),E(),x(6,"div",13)(7,"p")(8,"span",16),b(9,"ID:"),E(),b(10),E(),x(11,"p")(12,"span",16),b(13,"Company Name:"),E(),b(14),E(),x(15,"p")(16,"span",16),b(17,"Position:"),E(),b(18),E(),x(19,"p")(20,"span",16),b(21,"Client:"),E(),b(22),E(),x(23,"p")(24,"span",16),b(25,"Image URL:"),E(),b(26),E(),x(27,"p")(28,"span",16),b(29,"Technologies:"),E()(),x(30,"ul",17),Yt(31,Kw,2,1,"li",18),E(),x(32,"p")(33,"span",16),b(34,"Views:"),E()(),x(35,"ul",17),Yt(36,$w,2,2,"li",18),E()()(),x(37,"div",19)(38,"div",20)(39,"button",21),Mt("click",function(){We(e);let i=Xt();return He(i.solicitarEliminar(i.projectSeleccionado.id))}),b(40,"Eliminar"),E()(),x(41,"div")(42,"button",22),Mt("click",function(){We(e);let i=Xt();return He(i.cerrarDetalle())}),b(43,"Cerrar"),E()()()()}if(n&2){let e=Xt();z(3),xe(e.projectSeleccionado.title),z(2),xe(e.projectSeleccionado.description),z(5),Pt(" ",e.projectSeleccionado.id,""),z(4),Pt(" ",e.projectSeleccionado.companyName,""),z(4),Pt(" ",e.projectSeleccionado.position,""),z(4),Pt(" ",e.projectSeleccionado.client,""),z(4),Pt(" ",e.projectSeleccionado.imageUrl,""),z(5),Gt("ngForOf",e.projectSeleccionado.technologies),z(5),Gt("ngForOf",e.projectSeleccionado.views)}}var Vp=(()=>{let t=class t{mostrarDetalle(r){this.projectSeleccionado=r}cerrarDetalle(){this.projectSeleccionado=null}constructor(r){this.firestore=r,this.projects=[],this.projectSeleccionado=null,this.firestoreService=new Wo(this.firestore),this.firestoreService.setCollection("projects")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.projects=r},error:r=>{console.error("Error loading projects:",r)}})}eliminarProyecto(r){let i=this.firestoreService.deleteDocument(r);this.projectSeleccionado=null,console.log("response service delete",i)}solicitarEliminar(r){prompt(`Por favor, ingrese el ID del proyecto que desea eliminar: ${r} `)===r?window.confirm("\xBFEst\xE1s seguro de que deseas eliminar este proyecto definitivamente? Esta acci\xF3n no se puede deshacer.")&&this.eliminarProyecto(r):alert("El ID ingresado no coincide con el ID del proyecto. La eliminaci\xF3n ha sido cancelada.")}};t.\u0275fac=function(i){return new(i||t)(Je(xr))},t.\u0275cmp=Dn({type:t,selectors:[["app-list-page"]],decls:7,vars:2,consts:[[1,"flex","justify-center","bg-gray-400","h-screen"],[1,"w-full","md:w-4/12","mx-4","mt-3"],["routerLink","/mantainer/add",1,"w-full","bg-green-500","text-white","py-2","px-4","rounded","hover:bg-green-700","my-2"],["class","table-auto w-full bg-gray-700 text-white rounded",4,"ngIf"],[1,"w-full","md:w-8/12","mx-4","mt-3"],["class","max-w-xl mx-auto bg-gray-700 rounded-lg shadow-md overflow-hidden text-white",4,"ngIf"],[1,"table-auto","w-full","bg-gray-700","text-white","rounded"],[1,"bg-blue-800"],[1,"px-4","py-2"],["class","border-b border-gray-700",4,"ngFor","ngForOf"],[1,"border-b","border-gray-700"],["type","button",1,"text-blue-500","font-bold",3,"click"],[1,"max-w-xl","mx-auto","bg-gray-700","rounded-lg","shadow-md","overflow-hidden","text-white"],[1,"px-6","py-2"],[1,"text-xl","font-bold","mb-2"],[1,"text-gray-200","mb-4"],[1,"font-bold","text-gray-200"],[1,"list-disc","pl-4"],["class","text-gray-200",4,"ngFor","ngForOf"],[1,"px-6","py-4","bg-gray-700","flex","justify-end"],[1,"mr-2"],["type","button",1,"w-full","md:w-auto","text-red-500","font-bold",3,"click"],["type","button",1,"w-full","md:w-auto","text-blue-500","font-bold",3,"click"],[1,"text-gray-200"]],template:function(i,s){i&1&&(x(0,"div",0)(1,"div",1)(2,"button",2),b(3," register new project "),E(),Yt(4,zw,9,1,"table",3),E(),x(5,"div",4),Yt(6,Qw,44,9,"div",5),E()()),i&2&&(z(4),Gt("ngIf",s.projects&&s.projects.length>0),z(2),Gt("ngIf",s.projectSeleccionado))},dependencies:[Qi,Wi,Hi],styles:["[_nghost-%COMP%]{display:block}"]});let n=t;return n})();function Ww(n,t){if(n&1){let e=Vn();x(0,"tr")(1,"td",41),b(2),E(),x(3,"td",41),b(4),E(),x(5,"td",42)(6,"button",43),Mt("click",function(){let i=We(e).index,s=Xt(2);return He(s.eliminarObjeto(i))}),b(7," delet "),E()()()}if(n&2){let e=t.$implicit;z(2),xe(e.src),z(2),xe(e.description)}}function Hw(n,t){if(n&1&&(x(0,"table",37)(1,"thead")(2,"tr")(3,"th",38),b(4,"Src"),E(),x(5,"th",38),b(6,"Description"),E(),x(7,"th",39),b(8,"Delete"),E()()(),x(9,"tbody"),Yt(10,Ww,8,2,"tr",40),E()()),n&2){let e=Xt();z(10),Gt("ngForOf",e.formulario.controls.views.value)}}function Jw(n,t){if(n&1){let e=Vn();x(0,"li",30),b(1),x(2,"button",44),Mt("click",function(){let i=We(e).index,s=Xt();return He(s.eliminarString(i))}),b(3," X "),E()()}if(n&2){let e=t.$implicit;z(),Pt(" ",e," ")}}var Np=(()=>{let t=class t{constructor(r,i){this.formBuilder=r,this.firestore=i,this.formulario=this.formBuilder.group({title:["",me.required],client:["",me.required],companyName:["",me.required],descriptionProject:["",me.required],position:["",me.required],imageUrl:["",me.required],views:this.formBuilder.array([],me.required),technoligies:this.formBuilder.array([],me.required),src:[""],description:[""],nuevoString:[""]}),this.firestoreService=new Wo(this.firestore),this.firestoreService.setCollection("projects")}agregarObjeto(){let r=this.formulario.value.src,i=this.formulario.value.description;r&&i&&(this.formulario.get("views").push(this.formBuilder.group({src:r,description:i})),this.formulario.patchValue({src:"",description:""}))}eliminarObjeto(r){this.formulario.get("views").removeAt(r)}agregarString(){let r=this.formulario.value.nuevoString;r&&(this.formulario.get("technoligies").push(this.formBuilder.control(r)),this.formulario.patchValue({nuevoString:""}))}eliminarString(r){this.formulario.get("technoligies").removeAt(r)}onSave(){if(this.formulario.valid){let r={title:this.formulario.value.title,description:this.formulario.value.descriptionProject,imageUrl:this.formulario.value.imageUrl,companyName:this.formulario.value.companyName,position:this.formulario.value.position,client:this.formulario.value.client,technologies:this.formulario.value.technoligies,views:this.formulario.value.views};console.log(r),this.firestoreService.addDocument(r).subscribe({next:o=>{console.log("return service:",o)},error:o=>{console.error("Error loading projects:",o)}}),this.formulario.get("views").clear(),this.formulario.get("technoligies").clear(),this.formulario.reset()}else console.log("El formulario no es v\xE1lido. Por favor, completa todos los campos requeridos.")}};t.\u0275fac=function(i){return new(i||t)(Je(bh),Je(xr))},t.\u0275cmp=Dn({type:t,selectors:[["add-page"]],decls:81,vars:9,consts:[[1,"bg-gray-400","h-screen"],[1,"flex",3,"ngSubmit","formGroup"],[1,"bg-gray-400","w-3/12","p-2"],[1,"bg-gray-700","rounded","p-4","mb-2"],[1,"text-white","text-lg","mb-4","border-b-2"],["for","titulo",1,"block","text-gray-200","text-sm","my-2"],["type","text","id","title","formControlName","title",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","client",1,"block","text-gray-200","text-sm","my-2"],["type","text","id","client","formControlName","client",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","companyName",1,"block","text-gray-200","text-sm","my-2"],["type","text","id","companyName","formControlName","companyName",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","imageUrl",1,"block","text-gray-200","text-sm","my-2"],["type","text","id","imageUrl","formControlName","imageUrl",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","position",1,"block","text-gray-200","text-sm","my-2"],["type","text","id","position","formControlName","position",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","descriptionProject",1,"block","text-gray-200","text-sm","my-2"],["id","descriptionProject","formControlName","descriptionProject",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],[1,"bg-gray-400","p-2","w-4/12"],[1,"text-lg","mb-4","border-b-2","text-white"],["for","src",1,"block","text-gray-200","text-sm","mb-2"],["type","text","id","src","formControlName","src",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["for","description",1,"block","text-gray-200","text-sm","my-2"],["id","description","formControlName","description",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","py-1","px-4","rounded","focus:outline-none","focus:shadow-outline","my-2",3,"click"],[1,"text-white","text-lg","mb-4","border-b-2","mt-3"],["for","nuevoString",1,"block","text-gray-200","text-sm","mb-2"],["type","text","id","nuevoString","formControlName","nuevoString",1,"shadow","appearance-none","border","rounded","w-full","py-1","px-3","text-gray-900","leading-tight","focus:outline-none","focus:shadow-outline"],["type","button",1,"mt-3","bg-blue-500","hover:bg-blue-700","text-white","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"bg-gray-400","p-4","w-5/12"],[1,"block","text-gray-200","text-sm","font-bold","mb-2"],[1,"text-gray-300"],[1,"bg-gray-700","rounded","p-4","mb-2","text-white"],[1,"text-lg","font-bold","mb-2"],["class","table-auto w-full",4,"ngIf"],[1,"bg-gray-700","text-white","rounded","p-4","mb-2"],["class","text-gray-300",4,"ngFor","ngForOf"],["type","submit",1,"bg-green-500","hover:bg-green-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline","mt-4"],[1,"table-auto","w-full"],[1,"w-1/2","px-4","py-2"],[1,"w-1/8","px-4","py-2"],[4,"ngFor","ngForOf"],[1,"w-1/2","border","px-4","py-2"],[1,"w-1/8","border","px-4","py-2","items-center","justify-center"],["type","button",1,"text-red-500","font-bold",3,"click"],["type","button",1,"text-red-500","font-bold","ml-5",3,"click"]],template:function(i,s){i&1&&(x(0,"div",0)(1,"form",1),Mt("ngSubmit",function(){return s.onSave()}),x(2,"div",2)(3,"div",3)(4,"h2",4),b(5,"Add Propiedades"),E(),x(6,"label",5),b(7,"Title:"),E(),Ft(8,"input",6),x(9,"label",7),b(10,"Client:"),E(),Ft(11,"input",8),x(12,"label",9),b(13,"Company name:"),E(),Ft(14,"input",10),x(15,"label",11),b(16,"ImageUrl:"),E(),Ft(17,"input",12),x(18,"label",13),b(19,"Position:"),E(),Ft(20,"input",14),x(21,"label",15),b(22,"Description Project:"),E(),Ft(23,"textarea",16),E()(),x(24,"div",17)(25,"div",3)(26,"h2",18),b(27,"add new views project"),E(),x(28,"label",19),b(29,"Src:"),E(),Ft(30,"input",20),x(31,"label",21),b(32,"Descripci\xF3n:"),E(),Ft(33,"textarea",22),x(34,"button",23),Mt("click",function(){return s.agregarObjeto()}),b(35," ADD NEW VIEW "),E()(),x(36,"div",3)(37,"h2",24),b(38,"add new technologies project"),E(),x(39,"label",25),b(40,"Technologies:"),E(),Ft(41,"input",26),x(42,"button",27),Mt("click",function(){return s.agregarString()}),b(43," ADD NEW TECH "),E()()(),x(44,"div",28)(45,"div",3)(46,"label",29),b(47,"T\xEDtulo:"),E(),x(48,"span",30),b(49),E(),x(50,"label",29),b(51,"Client:"),E(),x(52,"span",30),b(53),E(),x(54,"label",29),b(55,"company Name:"),E(),x(56,"span",30),b(57),E(),x(58,"label",29),b(59,"project description:"),E(),x(60,"span",30),b(61),E(),x(62,"label",29),b(63,"project imageUrl:"),E(),x(64,"span",30),b(65),E(),x(66,"label",29),b(67,"position:"),E(),x(68,"span",30),b(69),E()(),x(70,"div",31)(71,"h3",32),b(72,"Views:"),E(),Yt(73,Hw,11,1,"table",33),E(),x(74,"div",34)(75,"h3",32),b(76,"Technologies:"),E(),x(77,"ul"),Yt(78,Jw,4,1,"li",35),E()(),x(79,"button",36),b(80," Register new project "),E()()()()),i&2&&(z(),Gt("formGroup",s.formulario),z(48),Pt("",s.formulario.controls.title.value," "),z(4),Pt("",s.formulario.controls.client.value," "),z(4),Pt("",s.formulario.controls.companyName.value," "),z(4),Pt("",s.formulario.controls.descriptionProject.value," "),z(4),Pt("",s.formulario.controls.imageUrl.value," "),z(4),Pt("",s.formulario.controls.position.value," "),z(4),Gt("ngIf",s.formulario.controls.views.value.length>0),z(5),Gt("ngForOf",s.formulario.controls.technoligies.value))},dependencies:[Qi,Wi,Ah,Ih,Eh,Th,Sh,xh]});let n=t;return n})();var Yw=[{path:"",component:Dh,children:[{path:"list",component:Vp},{path:"add",component:Np},{path:"**",redirectTo:"list"}]}],kp=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=Dr({type:t}),t.\u0275inj=Pr({imports:[Xo.forChild(Yw),Xo]});let n=t;return n})();var m0=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=Dr({type:t}),t.\u0275inj=Pr({imports:[Yl,Rh,kp,Ph,Ch]});let n=t;return n})();export{m0 as MantainerModule};
